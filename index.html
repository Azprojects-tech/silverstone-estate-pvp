<!DOCTYPE html>
<html lang="en">
<head>
    <style>
    .az-watermark {
        position: fixed;
        top: 140px;
        right: 15px;
        background: rgba(255, 255, 255, 0.85);
        padding: 6px 10px;
        border-radius: 6px;
        box-shadow: 0 2px 6px rgba(0,0,0,0.1);
        z-index: 1200;
        font-family: Arial, sans-serif;
        font-size: 11px;
        color: #666;
        border: 1px solid rgba(44, 95, 63, 0.3);
        max-width: 200px;
        opacity: 0.9;
    }
    
    .az-logo {
        width: 40px;
        height: auto;
        margin-right: 8px;
        vertical-align: middle;
    }
    
    .az-contact {
        font-weight: bold;
        color: #2c5f3f;
        text-decoration: none;
    }
    
    .az-footer {
        position: fixed;
        bottom: 15px;
        left: 15px;
        right: 15px;
        background: rgba(44, 95, 63, 0.8);
        color: white;
        padding: 4px 8px;
        font-family: Arial, sans-serif;
        font-size: 9px;
        border-radius: 3px;
        box-shadow: 0 1px 4px rgba(0,0,0,0.1);
        z-index: 1100;
        opacity: 0.85;
        text-align: center;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
        height: 20px;
    }
    
    .az-footer a {
        color: #ffffff;
        text-decoration: none;
        font-weight: bold;
    }
    
    .az-footer a:hover {
        text-decoration: underline;
    }
    
    /* Client Authentication & View Switching - Now in Legend */
    .admin-toggle {
        position: relative;
        margin: 8px 0 0 0;
        width: 100%;
        background: rgba(255, 255, 255, 0.85);
        color: #667eea;
        border: 1px solid rgba(102, 126, 234, 0.3);
        padding: 8px 10px;
        border-radius: 5px;
        cursor: pointer;
        font-size: 10px;
        font-weight: 600;
        box-shadow: 0 2px 6px rgba(0,0,0,0.15);
        backdrop-filter: blur(5px);
        opacity: 0.8;
        text-align: center;
    }
    
    .admin-toggle:hover {
        opacity: 1;
        background: rgba(255, 255, 255, 0.95);
        transform: translateY(-1px);
    }
    
    .client-view .admin-toggle {
        background: rgba(102, 126, 234, 0.9);
        color: white;
        opacity: 0.9;
    }
    
    /* Attribution Toggle - Moved to Admin Panel Line */
    .attribution-toggle {
        background: linear-gradient(135deg, #6c757d 0%, #495057 100%);
        color: white;
        border: none;
        padding: 6px 12px;
        border-radius: 20px;
        cursor: pointer;
        font-size: 11px;
        font-weight: 600;
        margin-left: 8px;
    }
    
    .attribution-toggle:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(0,0,0,0.2);
    }
    
    /* Hide Leaflet attribution by default */
    .leaflet-control-attribution {
        display: none !important;
    }
    
    .show-attribution .leaflet-control-attribution {
        display: block !important;
        position: fixed !important;
        bottom: 180px !important;
        right: 10px !important;
        font-size: 8px !important;
        max-width: 200px !important;
        background: rgba(255, 255, 255, 0.9) !important;
        padding: 4px 6px !important;
        border-radius: 4px !important;
        z-index: 1100 !important;
        line-height: 1.2 !important;
    }
    
    .client-login {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.8);
        z-index: 3000;
        justify-content: center;
        align-items: center;
    }
    
    .login-form {
        background: white;
        padding: 30px;
        border-radius: 15px;
        box-shadow: 0 10px 40px rgba(0,0,0,0.3);
        max-width: 400px;
        width: 90%;
    }
    
    .login-form h3 {
        margin-bottom: 20px;
        color: #2c3e50;
        text-align: center;
    }
    
    .login-form input {
        width: 100%;
        padding: 12px;
        margin-bottom: 15px;
        border: 2px solid #e9ecef;
        border-radius: 8px;
        font-size: 14px;
    }
    
    .login-form input:focus {
        outline: none;
        border-color: #667eea;
    }
    
    .login-btn {
        width: 100%;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border: none;
        padding: 12px;
        border-radius: 8px;
        cursor: pointer;
        font-weight: 600;
        font-size: 14px;
    }
    
    .client-only {
        display: none;
    }
    
    .client-view .client-only {
        display: block;
    }
    
    .customer-view .client-only {
        display: none;
    }
    
    /* Enhanced Database Panel Styles */
    .database-panel {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.9);
        z-index: 3500;
        justify-content: center;
        align-items: center;
        overflow-y: auto;
        padding: 20px;
        box-sizing: border-box;
    }
    
    .database-content {
        background: white;
        border-radius: 15px;
        box-shadow: 0 15px 50px rgba(0,0,0,0.4);
        max-width: 1200px;
        width: 100%;
        max-height: 90vh;
        overflow-y: auto;
    }
    
    .database-header {
        background: linear-gradient(135deg, #6f42c1 0%, #5a32a3 100%);
        color: white;
        padding: 20px;
        border-radius: 15px 15px 0 0;
        position: relative;
    }
    
    .database-header h3 {
        margin: 0;
        font-size: 18px;
        font-weight: 600;
    }
    
    .database-body {
        padding: 20px;
        max-height: 70vh;
        overflow-y: auto;
    }
    
    .database-summary {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 15px;
        margin-bottom: 25px;
    }
    
    .summary-card {
        background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
        padding: 15px;
        border-radius: 10px;
        border-left: 4px solid #6f42c1;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    
    .summary-card h4 {
        margin: 0 0 5px 0;
        color: #6f42c1;
        font-size: 14px;
        font-weight: 600;
    }
    
    .summary-card .value {
        font-size: 24px;
        font-weight: bold;
        color: #2c3e50;
    }
    
    .database-table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 15px;
        font-size: 12px;
    }
    
    .database-table th,
    .database-table td {
        padding: 8px 10px;
        text-align: left;
        border-bottom: 1px solid #dee2e6;
    }
    
    .database-table th {
        background: #f8f9fa;
        font-weight: 600;
        color: #495057;
        position: sticky;
        top: 0;
        z-index: 10;
    }
    
    .database-table tr:hover {
        background: #f8f9fa;
    }
    
    .payment-status {
        padding: 3px 8px;
        border-radius: 12px;
        font-size: 10px;
        font-weight: 600;
        text-transform: uppercase;
    }
    
    .payment-status.paid {
        background: #d4edda;
        color: #155724;
    }
    
    .payment-status.pending {
        background: #fff3cd;
        color: #856404;
    }
    
    /* Google Sheets Integration Indicator */
    .sync-status {
        position: fixed;
        top: 50px;
        left: 15px;
        background: rgba(40, 167, 69, 0.9);
        color: white;
        padding: 4px 8px;
        border-radius: 4px;
        font-size: 10px;
        z-index: 1150;
        display: none;
    }
    
    .sync-status.syncing {
        background: rgba(255, 193, 7, 0.9);
        display: block;
    }
    
    .sync-status.synced {
        background: rgba(40, 167, 69, 0.9);
        display: block;
    }
    
    .sync-status.error {
        background: rgba(220, 53, 69, 0.9);
        display: block;
    }

    /* Contact Modal Styles */
    .contact-modal {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.7);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 2000;
    }
    
    .modal-content {
        background: white;
        border-radius: 15px;
        width: 90%;
        max-width: 500px;
        max-height: 90vh;
        overflow-y: auto;
        box-shadow: 0 10px 40px rgba(0,0,0,0.3);
        animation: modalSlideIn 0.3s ease;
    }
    
    @keyframes modalSlideIn {
        from { opacity: 0; transform: translateY(-50px); }
        to { opacity: 1; transform: translateY(0); }
    }
    
    .modal-header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 20px;
        border-radius: 15px 15px 0 0;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    
    .modal-header h3 {
        margin: 0;
        font-size: 20px;
    }
    
    .close-btn {
        background: none;
        border: none;
        color: white;
        font-size: 24px;
        cursor: pointer;
        padding: 0;
        width: 30px;
        height: 30px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 50%;
        transition: background 0.3s;
    }
    
    .close-btn:hover {
        background: rgba(255, 255, 255, 0.2);
    }
    
    .modal-body {
        padding: 25px;
    }
    
    .form-group {
        margin-bottom: 20px;
    }
    
    .form-group label {
        display: block;
        margin-bottom: 5px;
        font-weight: 600;
        color: #2c3e50;
    }
    
    .form-group input,
    .form-group textarea {
        width: 100%;
        padding: 12px;
        border: 2px solid #e9ecef;
        border-radius: 8px;
        font-size: 14px;
        transition: border-color 0.3s;
    }
    
    .form-group input:focus,
    .form-group textarea:focus {
        outline: none;
        border-color: #667eea;
    }
    
    .form-actions {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
    }
    
    .btn-submit {
        background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
        color: white;
        border: none;
        padding: 12px 20px;
        border-radius: 8px;
        cursor: pointer;
        font-weight: 600;
        font-size: 14px;
        flex: 1;
        min-width: 150px;
        transition: transform 0.3s;
    }
    
    .btn-submit:hover {
        transform: translateY(-2px);
    }
    
    .btn-whatsapp {
        background: linear-gradient(135deg, #25d366 0%, #128c7e 100%);
        color: white;
        border: none;
        padding: 12px 20px;
        border-radius: 8px;
        cursor: pointer;
        font-weight: 600;
        font-size: 14px;
        flex: 1;
        min-width: 150px;
        transition: transform 0.3s;
    }
    
    .btn-whatsapp:hover {
        transform: translateY(-2px);
    }
    
    @media (max-width: 768px) {
        .az-footer {
            position: fixed;
            bottom: 8px;
            padding: 3px 6px;
            font-size: 8px;
            height: 18px;
        }
    }
    </style>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="google" content="notranslate">
    <meta name="robots" content="noindex, nofollow">
    <title>SILVERSTONE ESTATE OGBEKE - Real Estate Mapper</title>
    
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" 
          integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" 
          crossorigin=""/>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            height: 100vh;
            overflow: hidden;
        }
        
        .header {
            background: rgba(255, 255, 255, 0.95);
            padding: 15px 20px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
            position: relative;
            z-index: 1000;
        }
        
        .header h1 {
            color: #2c3e50;
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 5px;
        }
        
        .header p {
            color: #7f8c8d;
            font-size: 14px;
        }
        
        .controls {
            background: rgba(255, 255, 255, 0.95);
            padding: 15px 20px;
            box-shadow: 0 -4px 20px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
            position: fixed;
            bottom: 45px;
            left: 0;
            right: 0;
            z-index: 1000;
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .control-group {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        
        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 20px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            font-size: 11px;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.2);
        }
        
        .btn.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }
        
        select {
            padding: 6px 12px;
            border: 2px solid #e9ecef;
            border-radius: 18px;
            background: white;
            font-size: 11px;
            min-width: 100px;
        }
        
        select:focus {
            outline: none;
            border-color: #667eea;
        }
        
        #map {
            height: calc(100vh - 140px);
            width: 100%;
        }
        
        .legend {
            background: rgba(255, 255, 255, 0.95);
            padding: 8px 4px;
            border-radius: 4px;
            box-shadow: 0 1px 6px rgba(0,0,0,0.3);
            backdrop-filter: blur(10px);
            position: absolute;
            top: 60px;
            right: 5px;
            z-index: 1000;
            width: 45px;
        }
        
        .legend h4 {
            color: #2c3e50;
            margin-bottom: 6px;
            font-size: 8px;
            font-weight: bold;
            text-align: center;
            line-height: 1;
        }
        
        .legend-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-bottom: 4px;
            font-size: 7px;
            line-height: 1;
            text-align: center;
        }
        
        .legend-color {
            width: 30px;
            height: 8px;
            border-radius: 2px;
            margin-bottom: 2px;
            border: 0.5px solid rgba(0,0,0,0.3);
        }
        
        .parcel-popup {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 270px;
        }
        
        .parcel-popup h3 {
            color: #2c3e50;
            margin-bottom: 8px;
            font-size: 16px;
        }
        
        .parcel-popup p {
            margin-bottom: 4px;
            color: #555;
            font-size: 13px;
        }
        
        .status-badge {
            display: inline-block;
            padding: 3px 10px;
            border-radius: 13px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            margin-top: 8px;
        }
        
        .status-available {
            background: #d4edda;
            color: #155724;
        }
        
        .status-reserved {
            background: #fff3cd;
            color: #856404;
        }
        
        .status-sold {
            background: #f8d7da;
            color: #721c24;
        }
        
        .loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(255, 255, 255, 0.95);
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
            text-align: center;
            z-index: 2000;
        }
        
        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* PARCEL ENHANCEMENTS - MOBILE + NUMBERING + PRICING */
        .parcel-number-toggle {
            position: absolute;
            top: 135px;
            left: 15px;
            background: #28a745;
            color: white;
            border: none;
            padding: 6px 10px;
            border-radius: 5px;
            font-size: 10px;
            font-weight: 600;
            cursor: pointer;
            z-index: 1200;
            box-shadow: 0 2px 6px rgba(0,0,0,0.25);
        }

        .parcel-number-toggle:hover {
            background: #218838;
            transform: translateY(-1px);
        }

        .parcel-number-toggle.hidden {
            background: #6c757d;
        }

        .parcel-label {
            background: rgba(255,255,255,0.95) !important;
            border: 1px solid #007bff !important;
            border-radius: 3px !important;
            padding: 1px 3px !important;
            font-weight: 700 !important;
            font-size: 8px !important;
            color: #007bff !important;
            pointer-events: none !important;
            box-shadow: 0 1px 3px rgba(0,0,0,0.35) !important;
            text-shadow: 1px 1px 1px rgba(255,255,255,0.8) !important;
        }
        
        /* Zoom-responsive label sizes */
        .parcel-label-zoom-16 { font-size: 6px !important; padding: 0px 2px !important; }
        .parcel-label-zoom-17 { font-size: 7px !important; padding: 1px 2px !important; }
        .parcel-label-zoom-18 { font-size: 8px !important; padding: 1px 3px !important; }
        .parcel-label-zoom-19 { font-size: 9px !important; padding: 2px 3px !important; }
        .parcel-label-zoom-20 { font-size: 10px !important; padding: 2px 4px !important; }
        .parcel-label-zoom-21 { font-size: 11px !important; padding: 3px 4px !important; }
        .parcel-label-zoom-22 { font-size: 12px !important; padding: 3px 5px !important; }
        .parcel-label-zoom-23 { font-size: 13px !important; padding: 4px 5px !important; }
        .parcel-label-zoom-24 { font-size: 14px !important; padding: 4px 6px !important; }
        .parcel-label-zoom-25 { font-size: 15px !important; padding: 5px 6px !important; }
        
        .user-location {
            background: #ff4444 !important;
            border: 3px solid white !important;
            border-radius: 50% !important;
            box-shadow: 0 0 10px rgba(255, 68, 68, 0.6), 0 0 20px rgba(255, 68, 68, 0.4) !important;
            animation: pulse 2s infinite !important;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.2); opacity: 0.7; }
            100% { transform: scale(1); opacity: 1; }
        }

        /* MOBILE RESPONSIVENESS */
        @media (max-width: 768px) {
            .parcel-number-toggle {
                top: 80px;
                left: 8px;
                font-size: 11px;
                padding: 6px 10px;
            }
            
            .parcel-label {
                font-size: 7px !important;
                padding: 0px 2px !important;
            }
            
            .btn {
                font-size: 10px;
                padding: 5px 7px;
                min-width: 50px;
                white-space: nowrap;
            }
            
            .controls {
                position: fixed;
                bottom: 50px;
                left: 0;
                right: 0;
                padding: 10px;
                background: rgba(255,255,255,0.95);
                display: flex;
                flex-wrap: nowrap;
                gap: 8px;
                z-index: 900;
                box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
                overflow-x: auto;
                justify-content: flex-start;
            }
            
            .control-group {
                gap: 8px;
                flex-shrink: 0;
            }
            
            .az-footer {
                bottom: 8px;
                font-size: 8px;
                padding: 3px 6px;
                height: 18px;
            }
            
            .admin-toggle {
                top: 140px;
                right: 10px;
                font-size: 9px;
                padding: 5px 8px;
            }
            
            .show-attribution .leaflet-control-attribution {
                bottom: 160px !important;
                right: 8px !important;
                font-size: 7px !important;
                max-width: 180px !important;
            }
            
            .btn {
                font-size: 12px;
                padding: 8px 12px;
                flex: 1;
                min-width: 70px;
            }
            
            select {
                font-size: 12px;
                padding: 6px 10px;
                flex: 1;
            }
            
            #map {
                height: calc(100vh - 190px);
            }
            
            .legend {
                top: 60px;
                right: 8px;
                font-size: 11px;
                padding: 10px 5px;
                width: 55px;
            }
            
            .legend h4 {
                font-size: 9px;
                margin-bottom: 8px;
            }
            
            .legend-item {
                font-size: 8px;
                margin-bottom: 5px;
            }
            
            .legend-color {
                width: 35px;
                height: 10px;
                margin-bottom: 3px;
            }
        }

        @media (max-width: 480px) {
            .parcel-number-toggle {
                top: 75px;
                left: 5px;
                font-size: 10px;
                padding: 5px 8px;
            }
            
            .btn {
                font-size: 9px;
                padding: 4px 6px;
                min-width: 45px;
                white-space: nowrap;
                touch-action: manipulation;
            -webkit-tap-highlight-color: transparent;
        }
        
        /* Database Panel Styles */
        .database-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }
        
        .summary-card {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            border: 1px solid #dee2e6;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .summary-card h4 {
            margin: 0 0 8px 0;
            color: #495057;
            font-size: 12px;
        }
        
        .summary-card .value {
            font-size: 18px;
            font-weight: bold;
            color: #007bff;
        }
        
        .database-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
            font-size: 12px;
        }
        
        .database-table th,
        .database-table td {
            padding: 8px;
            text-align: left;
            border-bottom: 1px solid #dee2e6;
        }
        
        .database-table th {
            background-color: #f8f9fa;
            font-weight: 600;
            color: #495057;
        }
        
        .database-table tr:hover {
            background-color: #f8f9fa;
        }
        
        .status-badge {
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 10px;
            font-weight: 600;
            text-transform: uppercase;
        }
        
        .status-available {
            background-color: #d4edda;
            color: #155724;
        }
        
        .status-reserved {
            background-color: #fff3cd;
            color: #856404;
        }
        
        .status-sold {
            background-color: #f8d7da;
            color: #721c24;
        }            .btn:active {
                transform: scale(0.95);
                background: linear-gradient(135deg, #5a67d8 0%, #6b46c1 100%);
            }
            
            .controls {
                bottom: 35px;
                padding: 6px 8px;
                gap: 6px;
                flex-wrap: nowrap;
                overflow-x: auto;
                justify-content: flex-start;
            }
            
            .control-group {
                gap: 6px;
                flex-shrink: 0;
            }
            
            .legend {
                font-size: 7px;
                padding: 6px 3px;
                top: 50px;
                right: 3px;
                width: 40px;
            }
            
            .legend h4 {
                font-size: 7px;
                margin-bottom: 4px;
            }
            
            .legend-item {
                font-size: 6px;
                margin-bottom: 3px;
            }
            
            .legend-color {
                width: 25px;
                height: 6px;
                margin-bottom: 2px;
            }
            
            .az-footer {
                font-size: 7px;
                padding: 2px 4px;
                height: 16px;
                gap: 4px;
            }
            
            .admin-toggle {
                top: 110px;
                right: 8px;
                font-size: 8px;
                padding: 4px 6px;
            }
        }

        /* Ultra-compact for very small screens */
        @media (max-width: 360px) {
            .legend {
                font-size: 6px;
                padding: 4px 2px;
                top: 45px;
                right: 2px;
                width: 35px;
            }
            
            .legend h4 {
                font-size: 6px;
                margin-bottom: 3px;
            }
            
            .legend-item {
                font-size: 5px;
                margin-bottom: 2px;
                line-height: 1;
            }
            
            .legend-color {
                width: 20px;
                height: 5px;
                margin-bottom: 1px;
            }
        }

        /* LANDSCAPE MOBILE OPTIMIZATION */
        @media screen and (orientation: landscape) and (max-height: 600px) {
            .controls {
                transform: translateY(100%);
                transition: transform 0.3s ease-in-out;
            }
            
            .controls.show {
                transform: translateY(0);
            }
            
            .legend {
                opacity: 0.7;
                font-size: 6px !important;
                padding: 4px 2px !important;
                width: 35px !important;
                top: 10px !important;
            }
            
            .parcel-number-toggle {
                opacity: 0.7;
                font-size: 8px !important;
                padding: 3px 6px !important;
                top: 10px !important;
            }
            
            .admin-toggle {
                opacity: 0.7;
                font-size: 8px !important;
                padding: 3px 6px !important;
                top: 45px !important;
            }
            
            .az-footer {
                opacity: 0.8;
                font-size: 6px !important;
                padding: 1px 3px !important;
                height: 12px !important;
            }
        }
        
        /* Subtle styling for context features */
        .location-label, .estate-label {
            pointer-events: none !important;
        }
        
        /* Full-screen landscape mode */
        .landscape-mode {
            overflow: hidden;
        }
        
        .landscape-mode #map {
            height: 100vh !important;
            width: 100vw !important;
        }
        
        .landscape-mode .header {
            display: none;
        }
        
        .landscape-mode .legend {
            transform: scale(0.8);
            transform-origin: top right;
        }
        
        .landscape-mode .controls {
            bottom: 0;
        }
        
        .landscape-mode .az-footer {
            display: none;
        }
    </style>
</head>
<body class="customer-view">
    <!-- Sync Status Indicator -->
    <div class="sync-status" id="syncStatus">üìä Syncing with Google Sheets...</div>
    

    
    <!-- Client Login Modal -->
    <div class="client-login" id="clientLogin">
        <div class="login-form">
            <h3>üîê Client Access</h3>
            <input type="password" id="clientPassword" placeholder="Enter client password" onkeyup="handleLoginKeyup(event)">
            <button class="login-btn" onclick="authenticateClient()">Login</button>
            <button class="login-btn" onclick="closeLogin()" style="background: #6c757d; margin-top: 10px;">Cancel</button>
        </div>
    </div>

    <!-- Enhanced Database Panel -->
    <div class="database-panel" id="databasePanel" style="display: none;">
        <div class="database-content">
            <div class="database-header">
                <h3>üóÉÔ∏è SILVERSTONE ESTATE OGBEKE - CLIENT DATABASE</h3>
                <button onclick="closeDatabasePanel()" style="background: #dc3545; color: white; border: none; padding: 5px 10px; border-radius: 3px; cursor: pointer; float: right;">‚úï Close</button>
            </div>
            <div class="database-body" id="databaseBody">
                <div style="text-align: center; padding: 20px; color: #666;">
                    Loading database...
                </div>
            </div>
        </div>
    </div>

    <div class="header">
        <h1>SILVERSTONE ESTATE OGBEKE</h1>
    </div>
    
    <div class="loading" id="loading">
        <div class="spinner"></div>
        <p>Loading subdivision map data...</p>
    </div>
    
    <div id="map"></div>
    
    <div class="legend">
        <h4>Status</h4>
        <div class="legend-item">
            <div class="legend-color" style="background-color: #28a745;"></div>
            <span>Available</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background-color: #ffc107;"></div>
            <span>Reserved</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background-color: #dc3545;"></div>
            <span>Sold</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background-color: #6c757d;"></div>
            <span>N/A</span>
        </div>
        <!-- Admin Toggle positioned below hide numbers button -->
        <button class="admin-toggle" onclick="toggleView()" id="adminToggle">üë§ Admin</button>
    </div>
    
    <div class="controls">
        <div class="control-group">
            <button class="btn" id="mapBtn" onclick="toggleLayer('map')"> Map</button>
            <button class="btn active" id="satelliteBtn" onclick="toggleLayer('satellite')"> Satellite</button>
        </div>
        
        <div class="control-group">
            <button class="btn" onclick="locateUser()">üìç My Location</button>
            <button class="btn" onclick="zoomToSubdivision()"> Zoom to Subdivision</button>
        </div>
        
        <div class="control-group">
            <button class="btn" onclick="toggleLandView()" id="landBtn">üó∫Ô∏è Land</button>
            <input type="text" id="parcelSearch" placeholder="Search parcel" style="padding: 4px 8px; border: 2px solid #e9ecef; border-radius: 15px; font-size: 9px; width: auto; min-width: fit-content;" onkeyup="searchParcel(event)" oninput="resizeSearchInput(this)">
        </div>
        
        <div class="control-group client-only admin-panel" style="margin-left: auto;">
            <label for="parcelSelect" style="color: #2c3e50; font-weight: 600;">üîß Admin Panel:</label>
            <select id="parcelSelect" onchange="selectParcel()">
                <option value="">Select Parcel...</option>
            </select>
            <select id="statusSelect" onchange="updateParcelStatus()">
                <option value="available">Available</option>
                <option value="reserved">Reserved</option>
                <option value="sold">Sold</option>
            </select>
            <button class="btn" onclick="syncWithGoogleSheets()">üîÑ Admin Sync</button>
            <button class="btn" onclick="showDatabasePanel()" style="background: #6f42c1; color: white;">üóÉÔ∏è Database</button>
            <button class="btn" onclick="testGoogleSheetsConnection()" style="background: #ffc107; color: #212529;">üîç Test Connection</button>
            <button class="btn" onclick="testSyncMessages()" style="background: #28a745;">üí¨ Test Messages</button>
            <button class="attribution-toggle" onclick="toggleAttribution()" id="attributionToggle">‚ÑπÔ∏è Info</button>
        </div>
    </div>

    <!-- Leaflet JavaScript -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" 
            integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" 
            crossorigin=""></script>
    
    <script>
        // Embedded WGS84 GeoJSON data - SILVERSTONE ESTATE OGBEKE PARCELS (51 parcels)
        const subdivisionData = {
            "type": "FeatureCollection",
            "features": [
                        {
                                    "type": "Feature",
                                    "properties": {
                                                "Text": "P103",
                                                "Shape_Area": 449.804128693,
                                                "area": "449 sqm"
                                    },
                                    "geometry": {
                                                "type": "Polygon",
                                                "coordinates": [
                                                            [
                                                                        [
                                                                                    7.531562262837916,
                                                                                    6.596002365931876
                                                                        ],
                                                                        [
                                                                                    7.531531076074204,
                                                                                    6.595894871594314
                                                                        ],
                                                                        [
                                                                                    7.531269001572386,
                                                                                    6.595951108168215
                                                                        ],
                                                                        [
                                                                                    7.5313019984584,
                                                                                    6.596064842224895
                                                                        ],
                                                                        [
                                                                                    7.531326845818289,
                                                                                    6.596080829630026
                                                                        ],
                                                                        [
                                                                                    7.53154353138209,
                                                                                    6.596035237077532
                                                                        ],
                                                                        [
                                                                                    7.531562262837916,
                                                                                    6.596002365931876
                                                                        ]
                                                            ]
                                                ]
                                    }
                        },
                        {
                                    "type": "Feature",
                                    "properties": {
                                                "Text": "P103",
                                                "Shape_Area": 450.540007734,
                                                "area": "450 sqm"
                                    },
                                    "geometry": {
                                                "type": "Polygon",
                                                "coordinates": [
                                                            [
                                                                        [
                                                                                    7.531531076074204,
                                                                                    6.595894871594314
                                                                        ],
                                                                        [
                                                                                    7.531492679026768,
                                                                                    6.595762521581983
                                                                        ],
                                                                        [
                                                                                    7.53123060460331,
                                                                                    6.595818756341821
                                                                        ],
                                                                        [
                                                                                    7.531269001572386,
                                                                                    6.595951108168215
                                                                        ],
                                                                        [
                                                                                    7.531531076074204,
                                                                                    6.595894871594314
                                                                        ]
                                                            ]
                                                ]
                                    }
                        },
                        {
                                    "type": "Feature",
                                    "properties": {
                                                "Text": "P117",
                                                "Shape_Area": 450.547060822,
                                                "area": "450 sqm"
                                    },
                                    "geometry": {
                                                "type": "Polygon",
                                                "coordinates": [
                                                            [
                                                                        [
                                                                                    7.531492679026768,
                                                                                    6.595762521581983
                                                                        ],
                                                                        [
                                                                                    7.531454280194599,
                                                                                    6.595630167947964
                                                                        ],
                                                                        [
                                                                                    7.531192205838849,
                                                                                    6.595686404510984
                                                                        ],
                                                                        [
                                                                                    7.53123060460331,
                                                                                    6.595818756341821
                                                                        ],
                                                                        [
                                                                                    7.531492679026768,
                                                                                    6.595762521581983
                                                                        ]
                                                            ]
                                                ]
                                    }
                        },
                        {
                                    "type": "Feature",
                                    "properties": {
                                                "Text": "P118",
                                                "Shape_Area": 448.783650829,
                                                "area": "448 sqm"
                                    },
                                    "geometry": {
                                                "type": "Polygon",
                                                "coordinates": [
                                                            [
                                                                        [
                                                                                    7.531454280194599,
                                                                                    6.595630167947964
                                                                        ],
                                                                        [
                                                                                    7.531416182181783,
                                                                                    6.595498849742979
                                                                        ],
                                                                        [
                                                                                    7.531153808896287,
                                                                                    6.595554052686354
                                                                        ],
                                                                        [
                                                                                    7.531192205838849,
                                                                                    6.595686404510984
                                                                        ],
                                                                        [
                                                                                    7.531454280194599,
                                                                                    6.595630167947964
                                                                        ]
                                                            ]
                                                ]
                                    }
                        },
                        {
                                    "type": "Feature",
                                    "properties": {
                                                "Text": "P132",
                                                "Shape_Area": 450.540704569,
                                                "area": "450 sqm"
                                    },
                                    "geometry": {
                                                "type": "Polygon",
                                                "coordinates": [
                                                            [
                                                                        [
                                                                                    7.531416182181783,
                                                                                    6.595498849742979
                                                                        ],
                                                                        [
                                                                                    7.531377783370703,
                                                                                    6.595366497919342
                                                                        ],
                                                                        [
                                                                                    7.531115410153007,
                                                                                    6.595421702665906
                                                                        ],
                                                                        [
                                                                                    7.531153808896287,
                                                                                    6.595554052686354
                                                                        ],
                                                                        [
                                                                                    7.531416182181783,
                                                                                    6.595498849742979
                                                                        ]
                                                            ]
                                                ]
                                    }
                        },
                        {
                                    "type": "Feature",
                                    "properties": {
                                                "Text": "P78",
                                                "Shape_Area": 451.410561854,
                                                "area": "451 sqm"
                                    },
                                    "geometry": {
                                                "type": "Polygon",
                                                "coordinates": [
                                                            [
                                                                        [
                                                                                    7.531474390529798,
                                                                                    6.5963494385067
                                                                        ],
                                                                        [
                                                                                    7.531416228609804,
                                                                                    6.596153149099211
                                                                        ],
                                                                        [
                                                                                    7.531239150154185,
                                                                                    6.596190406462838
                                                                        ],
                                                                        [
                                                                                    7.531297402486675,
                                                                                    6.596386678056317
                                                                        ],
                                                                        [
                                                                                    7.531474390529798,
                                                                                    6.5963494385067
                                                                        ]
                                                            ]
                                                ]
                                    }
                        },
                        {
                                    "type": "Feature",
                                    "properties": {
                                                "Text": "P79",
                                                "Shape_Area": 451.525503891,
                                                "area": "451 sqm"
                                    },
                                    "geometry": {
                                                "type": "Polygon",
                                                "coordinates": [
                                                            [
                                                                        [
                                                                                    7.531297402486675,
                                                                                    6.596386678056317
                                                                        ],
                                                                        [
                                                                                    7.531239150154185,
                                                                                    6.596190406462838
                                                                        ],
                                                                        [
                                                                                    7.531062071680081,
                                                                                    6.59622766556626
                                                                        ],
                                                                        [
                                                                                    7.531120323944696,
                                                                                    6.596423935357041
                                                                        ],
                                                                        [
                                                                                    7.531297402486675,
                                                                                    6.596386678056317
                                                                        ]
                                                            ]
                                                ]
                                    }
                        },
                        {
                                    "type": "Feature",
                                    "properties": {
                                                "Text": "P80",
                                                "Shape_Area": 451.52033142,
                                                "area": "451 sqm"
                                    },
                                    "geometry": {
                                                "type": "Polygon",
                                                "coordinates": [
                                                            [
                                                                        [
                                                                                    7.531120323944696,
                                                                                    6.596423935357041
                                                                        ],
                                                                        [
                                                                                    7.531062071680081,
                                                                                    6.59622766556626
                                                                        ],
                                                                        [
                                                                                    7.530884996815454,
                                                                                    6.596264922802889
                                                                        ],
                                                                        [
                                                                                    7.530943245384231,
                                                                                    6.596461194397559
                                                                        ],
                                                                        [
                                                                                    7.531120323944696,
                                                                                    6.596423935357041
                                                                        ]
                                                            ]
                                                ]
                                    }
                        },
                        {
                                    "type": "Feature",
                                    "properties": {
                                                "Text": "P81",
                                                "Shape_Area": 451.531264476,
                                                "area": "451 sqm"
                                    },
                                    "geometry": {
                                                "type": "Polygon",
                                                "coordinates": [
                                                            [
                                                                        [
                                                                                    7.530943245384231,
                                                                                    6.596461194397559
                                                                        ],
                                                                        [
                                                                                    7.530884996815454,
                                                                                    6.596264922802889
                                                                        ],
                                                                        [
                                                                                    7.530769840148305,
                                                                                    6.59628915028903
                                                                        ],
                                                                        [
                                                                                    7.530707914703083,
                                                                                    6.596302179949374
                                                                        ],
                                                                        [
                                                                                    7.530766166815944,
                                                                                    6.596498451560626
                                                                        ],
                                                                        [
                                                                                    7.530943245384231,
                                                                                    6.596461194397559
                                                                        ]
                                                            ]
                                                ]
                                    }
                        },
                        {
                                    "type": "Feature",
                                    "properties": {
                                                "Text": "P82",
                                                "Shape_Area": 457.067826388,
                                                "area": "457 sqm"
                                    },
                                    "geometry": {
                                                "type": "Polygon",
                                                "coordinates": [
                                                            [
                                                                        [
                                                                                    7.530766166815944,
                                                                                    6.596498451560626
                                                                        ],
                                                                        [
                                                                                    7.530707914703083,
                                                                                    6.596302179949374
                                                                        ],
                                                                        [
                                                                                    7.530553154472751,
                                                                                    6.596334742464601
                                                                        ],
                                                                        [
                                                                                    7.530534164311677,
                                                                                    6.59636638291723
                                                                        ],
                                                                        [
                                                                                    7.53057817425965,
                                                                                    6.596518076619899
                                                                        ],
                                                                        [
                                                                                    7.530602761174459,
                                                                                    6.596532831609551
                                                                        ],
                                                                        [
                                                                                    7.530766166815944,
                                                                                    6.596498451560626
                                                                        ]
                                                            ]
                                                ]
                                    }
                        },
                        {
                                    "type": "Feature",
                                    "properties": {
                                                "Text": "P77",
                                                "Shape_Area": 450.125149464,
                                                "area": "450 sqm"
                                    },
                                    "geometry": {
                                                "type": "Polygon",
                                                "coordinates": [
                                                            [
                                                                        [
                                                                                    7.53165210789803,
                                                                                    6.596312047301419
                                                                        ],
                                                                        [
                                                                                    7.531602649149165,
                                                                                    6.596141571125342
                                                                        ],
                                                                        [
                                                                                    7.531568541952476,
                                                                                    6.596121101782975
                                                                        ],
                                                                        [
                                                                                    7.531486746894092,
                                                                                    6.596138312493927
                                                                        ],
                                                                        [
                                                                                    7.531416228609804,
                                                                                    6.596153149099211
                                                                        ],
                                                                        [
                                                                                    7.531474390529798,
                                                                                    6.5963494385067
                                                                        ],
                                                                        [
                                                                                    7.53165210789803,
                                                                                    6.596312047301419
                                                                        ]
                                                            ]
                                                ]
                                    }
                        },
                        {
                                    "type": "Feature",
                                    "properties": {
                                                "Text": "P74",
                                                "Shape_Area": 450.540866729,
                                                "area": "450 sqm"
                                    },
                                    "geometry": {
                                                "type": "Polygon",
                                                "coordinates": [
                                                            [
                                                                        [
                                                                                    7.531479004871458,
                                                                                    6.596701804207012
                                                                        ],
                                                                        [
                                                                                    7.531403744681783,
                                                                                    6.596444424630188
                                                                        ],
                                                                        [
                                                                                    7.531268886627725,
                                                                                    6.596472799293871
                                                                        ],
                                                                        [
                                                                                    7.531344146744296,
                                                                                    6.596730178876316
                                                                        ],
                                                                        [
                                                                                    7.531479004871458,
                                                                                    6.596701804207012
                                                                        ]
                                                            ]
                                                ]
                                    }
                        },
                        {
                                    "type": "Feature",
                                    "properties": {
                                                "Text": "P75",
                                                "Shape_Area": 450.540866723,
                                                "area": "450 sqm"
                                    },
                                    "geometry": {
                                                "type": "Polygon",
                                                "coordinates": [
                                                            [
                                                                        [
                                                                                    7.531613862990999,
                                                                                    6.596673429497788
                                                                        ],
                                                                        [
                                                                                    7.531538602728203,
                                                                                    6.596416049926565
                                                                        ],
                                                                        [
                                                                                    7.531403744681783,
                                                                                    6.596444424630188
                                                                        ],
                                                                        [
                                                                                    7.531479004871458,
                                                                                    6.596701804207012
                                                                        ],
                                                                        [
                                                                                    7.531613862990999,
                                                                                    6.596673429497788
                                                                        ]
                                                            ]
                                                ]
                                    }
                        },
                        {
                                    "type": "Feature",
                                    "properties": {
                                                "Text": "P76",
                                                "Shape_Area": 451.465179503,
                                                "area": "451 sqm"
                                    },
                                    "geometry": {
                                                "type": "Polygon",
                                                "coordinates": [
                                                            [
                                                                        [
                                                                                    7.5317487211029,
                                                                                    6.59664505474866
                                                                        ],
                                                                        [
                                                                                    7.531674014559863,
                                                                                    6.596387559252049
                                                                        ],
                                                                        [
                                                                                    7.531538602728203,
                                                                                    6.596416049926565
                                                                        ],
                                                                        [
                                                                                    7.531613862990999,
                                                                                    6.596673429497788
                                                                        ],
                                                                        [
                                                                                    7.5317487211029,
                                                                                    6.59664505474866
                                                                        ]
                                                            ]
                                                ]
                                    }
                        },
                        {
                                    "type": "Feature",
                                    "properties": {
                                                "Text": "P54",
                                                "Shape_Area": 450.022779315,
                                                "area": "450 sqm"
                                    },
                                    "geometry": {
                                                "type": "Polygon",
                                                "coordinates": [
                                                            [
                                                                        [
                                                                                    7.530879420240561,
                                                                                    6.597101172692281
                                                                        ],
                                                                        [
                                                                                    7.530804714159349,
                                                                                    6.596843677154274
                                                                        ],
                                                                        [
                                                                                    7.530668951103957,
                                                                                    6.596872240673298
                                                                        ],
                                                                        [
                                                                                    7.530738446790648,
                                                                                    6.597111784581613
                                                                        ],
                                                                        [
                                                                                    7.530774077853361,
                                                                                    6.597123336457027
                                                                        ],
                                                                        [
                                                                                    7.530879420240561,
                                                                                    6.597101172692281
                                                                        ]
                                                            ]
                                                ]
                                    }
                        },
                        {
                                    "type": "Feature",
                                    "properties": {
                                                "Text": "P53",
                                                "Shape_Area": 450.540550217,
                                                "area": "450 sqm"
                                    },
                                    "geometry": {
                                                "type": "Polygon",
                                                "coordinates": [
                                                            [
                                                                        [
                                                                                    7.531014278466057,
                                                                                    6.597072799985873
                                                                        ],
                                                                        [
                                                                                    7.530939572317023,
                                                                                    6.596815302644677
                                                                        ],
                                                                        [
                                                                                    7.530804714159349,
                                                                                    6.596843677154274
                                                                        ],
                                                                        [
                                                                                    7.530879420240561,
                                                                                    6.597101172692281
                                                                        ],
                                                                        [
                                                                                    7.531014278466057,
                                                                                    6.597072799985873
                                                                        ]
                                                            ]
                                                ]
                                    }
                        },
                        {
                                    "type": "Feature",
                                    "properties": {
                                                "Text": "P52",
                                                "Shape_Area": 450.542875055,
                                                "area": "450 sqm"
                                    },
                                    "geometry": {
                                                "type": "Polygon",
                                                "coordinates": [
                                                            [
                                                                        [
                                                                                    7.531149136689262,
                                                                                    6.597044425430901
                                                                        ],
                                                                        [
                                                                                    7.531074430467078,
                                                                                    6.596786928095139
                                                                        ],
                                                                        [
                                                                                    7.530939572317023,
                                                                                    6.596815302644677
                                                                        ],
                                                                        [
                                                                                    7.531014278466057,
                                                                                    6.597072799985873
                                                                        ],
                                                                        [
                                                                                    7.531149136689262,
                                                                                    6.597044425430901
                                                                        ]
                                                            ]
                                                ]
                                    }
                        },
                        {
                                    "type": "Feature",
                                    "properties": {
                                                "Text": "P51",
                                                "Shape_Area": 450.5397119,
                                                "area": "450 sqm"
                                    },
                                    "geometry": {
                                                "type": "Polygon",
                                                "coordinates": [
                                                            [
                                                                        [
                                                                                    7.531283993096181,
                                                                                    6.597016050830694
                                                                        ],
                                                                        [
                                                                                    7.531209288609498,
                                                                                    6.59675855350568
                                                                        ],
                                                                        [
                                                                                    7.531074430467078,
                                                                                    6.596786928095139
                                                                        ],
                                                                        [
                                                                                    7.531149136689262,
                                                                                    6.597044425430901
                                                                        ],
                                                                        [
                                                                                    7.531283993096181,
                                                                                    6.597016050830694
                                                                        ]
                                                            ]
                                                ]
                                    }
                        },
                        {
                                    "type": "Feature",
                                    "properties": {
                                                "Text": "P50",
                                                "Shape_Area": 450.542238728,
                                                "area": "450 sqm"
                                    },
                                    "geometry": {
                                                "type": "Polygon",
                                                "coordinates": [
                                                            [
                                                                        [
                                                                                    7.531418851304119,
                                                                                    6.596987676195877
                                                                        ],
                                                                        [
                                                                                    7.531344146744296,
                                                                                    6.596730178876316
                                                                        ],
                                                                        [
                                                                                    7.531209288609498,
                                                                                    6.59675855350568
                                                                        ],
                                                                        [
                                                                                    7.531283993096181,
                                                                                    6.597016050830694
                                                                        ],
                                                                        [
                                                                                    7.531418851304119,
                                                                                    6.596987676195877
                                                                        ]
                                                            ]
                                                ]
                                    }
                        },
                        {
                                    "type": "Feature",
                                    "properties": {
                                                "Text": "P49",
                                                "Shape_Area": 450.542238721,
                                                "area": "450 sqm"
                                    },
                                    "geometry": {
                                                "type": "Polygon",
                                                "coordinates": [
                                                            [
                                                                        [
                                                                                    7.531553709504436,
                                                                                    6.596959301521134
                                                                        ],
                                                                        [
                                                                                    7.531479004871458,
                                                                                    6.596701804207012
                                                                        ],
                                                                        [
                                                                                    7.531344146744296,
                                                                                    6.596730178876316
                                                                        ],
                                                                        [
                                                                                    7.531418851304119,
                                                                                    6.596987676195877
                                                                        ],
                                                                        [
                                                                                    7.531553709504436,
                                                                                    6.596959301521134
                                                                        ]
                                                            ]
                                                ]
                                    }
                        },
                        {
                                    "type": "Feature",
                                    "properties": {
                                                "Text": "P48",
                                                "Shape_Area": 450.542238728,
                                                "area": "450 sqm"
                                    },
                                    "geometry": {
                                                "type": "Polygon",
                                                "coordinates": [
                                                            [
                                                                        [
                                                                                    7.531688567697115,
                                                                                    6.59693092680649
                                                                        ],
                                                                        [
                                                                                    7.531613862990999,
                                                                                    6.596673429497788
                                                                        ],
                                                                        [
                                                                                    7.531479004871458,
                                                                                    6.596701804207012
                                                                        ],
                                                                        [
                                                                                    7.531553709504436,
                                                                                    6.596959301521134
                                                                        ],
                                                                        [
                                                                                    7.531688567697115,
                                                                                    6.59693092680649
                                                                        ]
                                                            ]
                                                ]
                                    }
                        },
                        {
                                    "type": "Feature",
                                    "properties": {
                                                "Text": "P47",
                                                "Shape_Area": 450.542238728,
                                                "area": "450 sqm"
                                    },
                                    "geometry": {
                                                "type": "Polygon",
                                                "coordinates": [
                                                            [
                                                                        [
                                                                                    7.531823425882171,
                                                                                    6.596902552051903
                                                                        ],
                                                                        [
                                                                                    7.5317487211029,
                                                                                    6.59664505474866
                                                                        ],
                                                                        [
                                                                                    7.531613862990999,
                                                                                    6.596673429497788
                                                                        ],
                                                                        [
                                                                                    7.531688567697115,
                                                                                    6.59693092680649
                                                                        ],
                                                                        [
                                                                                    7.531823425882171,
                                                                                    6.596902552051903
                                                                        ]
                                                            ]
                                                ]
                                    }
                        },
                        {
                                    "type": "Feature",
                                    "properties": {
                                                "Text": "P72",
                                                "Shape_Area": 450.540866723,
                                                "area": "450 sqm"
                                    },
                                    "geometry": {
                                                "type": "Polygon",
                                                "coordinates": [
                                                            [
                                                                        [
                                                                                    7.531209288609498,
                                                                                    6.59675855350568
                                                                        ],
                                                                        [
                                                                                    7.531134028566049,
                                                                                    6.596501173917654
                                                                        ],
                                                                        [
                                                                                    7.530999170496737,
                                                                                    6.596529548501516
                                                                        ],
                                                                        [
                                                                                    7.531074430467078,
                                                                                    6.596786928095139
                                                                        ],
                                                                        [
                                                                                    7.531209288609498,
                                                                                    6.59675855350568
                                                                        ]
                                                            ]
                                                ]
                                    }
                        },
                        {
                                    "type": "Feature",
                                    "properties": {
                                                "Text": "P70",
                                                "Shape_Area": 450.543847364,
                                                "area": "450 sqm"
                                    },
                                    "geometry": {
                                                "type": "Polygon",
                                                "coordinates": [
                                                            [
                                                                        [
                                                                                    7.530939572317023,
                                                                                    6.596815302644677
                                                                        ],
                                                                        [
                                                                                    7.530864312425135,
                                                                                    6.596557921236816
                                                                        ],
                                                                        [
                                                                                    7.530729454340571,
                                                                                    6.596586295740835
                                                                        ],
                                                                        [
                                                                                    7.530804714159349,
                                                                                    6.596843677154274
                                                                        ],
                                                                        [
                                                                                    7.530939572317023,
                                                                                    6.596815302644677
                                                                        ]
                                                            ]
                                                ]
                                    }
                        },
                        {
                                    "type": "Feature",
                                    "properties": {
                                                "Text": "P69",
                                                "Shape_Area": 448.768528666,
                                                "area": "448 sqm"
                                    },
                                    "geometry": {
                                                "type": "Polygon",
                                                "coordinates": [
                                                            [
                                                                        [
                                                                                    7.530804714159349,
                                                                                    6.596843677154274
                                                                        ],
                                                                        [
                                                                                    7.530729454340571,
                                                                                    6.596586295740835
                                                                        ],
                                                                        [
                                                                                    7.53062466947804,
                                                                                    6.59660834357789
                                                                        ],
                                                                        [
                                                                                    7.530599935291323,
                                                                                    6.596634356704544
                                                                        ],
                                                                        [
                                                                                    7.530668951103957,
                                                                                    6.596872240673298
                                                                        ],
                                                                        [
                                                                                    7.530680235132263,
                                                                                    6.596869866624722
                                                                        ],
                                                                        [
                                                                                    7.530804714159349,
                                                                                    6.596843677154274
                                                                        ]
                                                            ]
                                                ]
                                    }
                        },
                        {
                                    "type": "Feature",
                                    "properties": {
                                                "Text": "P73",
                                                "Shape_Area": 450.540866729,
                                                "area": "450 sqm"
                                    },
                                    "geometry": {
                                                "type": "Polygon",
                                                "coordinates": [
                                                            [
                                                                        [
                                                                                    7.531344146744296,
                                                                                    6.596730178876316
                                                                        ],
                                                                        [
                                                                                    7.531268886627725,
                                                                                    6.596472799293871
                                                                        ],
                                                                        [
                                                                                    7.531134028566049,
                                                                                    6.596501173917654
                                                                        ],
                                                                        [
                                                                                    7.531209288609498,
                                                                                    6.59675855350568
                                                                        ],
                                                                        [
                                                                                    7.531344146744296,
                                                                                    6.596730178876316
                                                                        ]
                                                            ]
                                                ]
                                    }
                        },
                        {
                                    "type": "Feature",
                                    "properties": {
                                                "Text": "P40",
                                                "Shape_Area": 450.538341233,
                                                "area": "450 sqm"
                                    },
                                    "geometry": {
                                                "type": "Polygon",
                                                "coordinates": [
                                                            [
                                                                        [
                                                                                    7.531110891252233,
                                                                                    6.597405807485211
                                                                        ],
                                                                        [
                                                                                    7.531035629430558,
                                                                                    6.597148427873027
                                                                        ],
                                                                        [
                                                                                    7.530900772986898,
                                                                                    6.597176802394833
                                                                        ],
                                                                        [
                                                                                    7.530976032926795,
                                                                                    6.59743418200727
                                                                        ],
                                                                        [
                                                                                    7.531110891252233,
                                                                                    6.597405807485211
                                                                        ]
                                                            ]
                                                ]
                                    }
                        },
                        {
                                    "type": "Feature",
                                    "properties": {
                                                "Text": "P41",
                                                "Shape_Area": 450.538341221,
                                                "area": "450 sqm"
                                    },
                                    "geometry": {
                                                "type": "Polygon",
                                                "coordinates": [
                                                            [
                                                                        [
                                                                                    7.531245747761384,
                                                                                    6.597377432917881
                                                                        ],
                                                                        [
                                                                                    7.531170487675237,
                                                                                    6.597120053316643
                                                                        ],
                                                                        [
                                                                                    7.531035629430558,
                                                                                    6.597148427873027
                                                                        ],
                                                                        [
                                                                                    7.531110891252233,
                                                                                    6.597405807485211
                                                                        ],
                                                                        [
                                                                                    7.531245747761384,
                                                                                    6.597377432917881
                                                                        ]
                                                            ]
                                                ]
                                    }
                        },
                        {
                                    "type": "Feature",
                                    "properties": {
                                                "Text": "P42",
                                                "Shape_Area": 450.540866711,
                                                "area": "450 sqm"
                                    },
                                    "geometry": {
                                                "type": "Polygon",
                                                "coordinates": [
                                                            [
                                                                        [
                                                                                    7.531380606071554,
                                                                                    6.597349058315953
                                                                        ],
                                                                        [
                                                                                    7.531305345912288,
                                                                                    6.597091678720319
                                                                        ],
                                                                        [
                                                                                    7.531170487675237,
                                                                                    6.597120053316643
                                                                        ],
                                                                        [
                                                                                    7.531245747761384,
                                                                                    6.597377432917881
                                                                        ],
                                                                        [
                                                                                    7.531380606071554,
                                                                                    6.597349058315953
                                                                        ]
                                                            ]
                                                ]
                                    }
                        },
                        {
                                    "type": "Feature",
                                    "properties": {
                                                "Text": "P43",
                                                "Shape_Area": 450.540866707,
                                                "area": "450 sqm"
                                    },
                                    "geometry": {
                                                "type": "Polygon",
                                                "coordinates": [
                                                            [
                                                                        [
                                                                                    7.531515464374094,
                                                                                    6.597320683674118
                                                                        ],
                                                                        [
                                                                                    7.531440204141717,
                                                                                    6.597063304084084
                                                                        ],
                                                                        [
                                                                                    7.531305345912288,
                                                                                    6.597091678720319
                                                                        ],
                                                                        [
                                                                                    7.531380606071554,
                                                                                    6.597349058315953
                                                                        ],
                                                                        [
                                                                                    7.531515464374094,
                                                                                    6.597320683674118
                                                                        ]
                                                            ]
                                                ]
                                    }
                        },
                        {
                                    "type": "Feature",
                                    "properties": {
                                                "Text": "P44",
                                                "Shape_Area": 450.540866723,
                                                "area": "450 sqm"
                                    },
                                    "geometry": {
                                                "type": "Polygon",
                                                "coordinates": [
                                                            [
                                                                        [
                                                                                    7.531650322669012,
                                                                                    6.59729230899234
                                                                        ],
                                                                        [
                                                                                    7.531575062363507,
                                                                                    6.597034929407913
                                                                        ],
                                                                        [
                                                                                    7.531440204141717,
                                                                                    6.597063304084084
                                                                        ],
                                                                        [
                                                                                    7.531515464374094,
                                                                                    6.597320683674118
                                                                        ],
                                                                        [
                                                                                    7.531650322669012,
                                                                                    6.59729230899234
                                                                        ]
                                                            ]
                                                ]
                                    }
                        },
                        {
                                    "type": "Feature",
                                    "properties": {
                                                "Text": "P45",
                                                "Shape_Area": 450.541516447,
                                                "area": "450 sqm"
                                    },
                                    "geometry": {
                                                "type": "Polygon",
                                                "coordinates": [
                                                            [
                                                                        [
                                                                                    7.531785180950963,
                                                                                    6.597263936079276
                                                                        ],
                                                                        [
                                                                                    7.531709920577676,
                                                                                    6.597006554691817
                                                                        ],
                                                                        [
                                                                                    7.531575062363507,
                                                                                    6.597034929407913
                                                                        ],
                                                                        [
                                                                                    7.531650322669012,
                                                                                    6.59729230899234
                                                                        ],
                                                                        [
                                                                                    7.531785180950963,
                                                                                    6.597263936079276
                                                                        ]
                                                            ]
                                                ]
                                    }
                        },
                        {
                                    "type": "Feature",
                                    "properties": {
                                                "Text": "P46",
                                                "Shape_Area": 451.468166291,
                                                "area": "451 sqm"
                                    },
                                    "geometry": {
                                                "type": "Polygon",
                                                "coordinates": [
                                                            [
                                                                        [
                                                                                    7.531920039230617,
                                                                                    6.597235561317653
                                                                        ],
                                                                        [
                                                                                    7.531845332577763,
                                                                                    6.596978064004775
                                                                        ],
                                                                        [
                                                                                    7.531709920577676,
                                                                                    6.597006554691817
                                                                        ],
                                                                        [
                                                                                    7.531785180950963,
                                                                                    6.597263936079276
                                                                        ],
                                                                        [
                                                                                    7.531920039230617,
                                                                                    6.597235561317653
                                                                        ]
                                                            ]
                                                ]
                                    }
                        },
                        {
                                    "type": "Feature",
                                    "properties": {
                                                "Text": "P23",
                                                "Shape_Area": 450.539711906,
                                                "area": "450 sqm"
                                    },
                                    "geometry": {
                                                "type": "Polygon",
                                                "coordinates": [
                                                            [
                                                                        [
                                                                                    7.531320454098694,
                                                                                    6.597634930261301
                                                                        ],
                                                                        [
                                                                                    7.531245747761384,
                                                                                    6.597377432917881
                                                                        ],
                                                                        [
                                                                                    7.531110891252233,
                                                                                    6.597405807485211
                                                                        ],
                                                                        [
                                                                                    7.531185595707728,
                                                                                    6.597663304828743
                                                                        ],
                                                                        [
                                                                                    7.531320454098694,
                                                                                    6.597634930261301
                                                                        ]
                                                            ]
                                                ]
                                    }
                        },
                        {
                                    "type": "Feature",
                                    "properties": {
                                                "Text": "P22",
                                                "Shape_Area": 450.542875035,
                                                "area": "450 sqm"
                                    },
                                    "geometry": {
                                                "type": "Polygon",
                                                "coordinates": [
                                                            [
                                                                        [
                                                                                    7.531455312482018,
                                                                                    6.597606555653951
                                                                        ],
                                                                        [
                                                                                    7.531380606071554,
                                                                                    6.597349058315953
                                                                        ],
                                                                        [
                                                                                    7.531245747761384,
                                                                                    6.597377432917881
                                                                        ],
                                                                        [
                                                                                    7.531320454098694,
                                                                                    6.597634930261301
                                                                        ],
                                                                        [
                                                                                    7.531455312482018,
                                                                                    6.597606555653951
                                                                        ]
                                                            ]
                                                ]
                                    }
                        },
                        {
                                    "type": "Feature",
                                    "properties": {
                                                "Text": "P21",
                                                "Shape_Area": 450.542875035,
                                                "area": "450 sqm"
                                    },
                                    "geometry": {
                                                "type": "Polygon",
                                                "coordinates": [
                                                            [
                                                                        [
                                                                                    7.531590170857712,
                                                                                    6.597578181006659
                                                                        ],
                                                                        [
                                                                                    7.531515464374094,
                                                                                    6.597320683674118
                                                                        ],
                                                                        [
                                                                                    7.531380606071554,
                                                                                    6.597349058315953
                                                                        ],
                                                                        [
                                                                                    7.531455312482018,
                                                                                    6.597606555653951
                                                                        ],
                                                                        [
                                                                                    7.531590170857712,
                                                                                    6.597578181006659
                                                                        ]
                                                            ]
                                                ]
                                    }
                        },
                        {
                                    "type": "Feature",
                                    "properties": {
                                                "Text": "P20",
                                                "Shape_Area": 450.542875055,
                                                "area": "450 sqm"
                                    },
                                    "geometry": {
                                                "type": "Polygon",
                                                "coordinates": [
                                                            [
                                                                        [
                                                                                    7.531725029225781,
                                                                                    6.59754980631944
                                                                        ],
                                                                        [
                                                                                    7.531650322669012,
                                                                                    6.59729230899234
                                                                        ],
                                                                        [
                                                                                    7.531515464374094,
                                                                                    6.597320683674118
                                                                        ],
                                                                        [
                                                                                    7.531590170857712,
                                                                                    6.597578181006659
                                                                        ],
                                                                        [
                                                                                    7.531725029225781,
                                                                                    6.59754980631944
                                                                        ]
                                                            ]
                                                ]
                                    }
                        },
                        {
                                    "type": "Feature",
                                    "properties": {
                                                "Text": "P19",
                                                "Shape_Area": 450.537387102,
                                                "area": "450 sqm"
                                    },
                                    "geometry": {
                                                "type": "Polygon",
                                                "coordinates": [
                                                            [
                                                                        [
                                                                                    7.531859885777559,
                                                                                    6.597521431586985
                                                                        ],
                                                                        [
                                                                                    7.531785180950963,
                                                                                    6.597263936079276
                                                                        ],
                                                                        [
                                                                                    7.531650322669012,
                                                                                    6.59729230899234
                                                                        ],
                                                                        [
                                                                                    7.531725029225781,
                                                                                    6.59754980631944
                                                                        ],
                                                                        [
                                                                                    7.531859885777559,
                                                                                    6.597521431586985
                                                                        ]
                                                            ]
                                                ]
                                    }
                        },
                        {
                                    "type": "Feature",
                                    "properties": {
                                                "Text": "P18",
                                                "Shape_Area": 450.539258086,
                                                "area": "450 sqm"
                                    },
                                    "geometry": {
                                                "type": "Polygon",
                                                "coordinates": [
                                                            [
                                                                        [
                                                                                    7.531994744130353,
                                                                                    6.597493056819915
                                                                        ],
                                                                        [
                                                                                    7.531920039230617,
                                                                                    6.597235561317653
                                                                        ],
                                                                        [
                                                                                    7.531785180950963,
                                                                                    6.597263936079276
                                                                        ],
                                                                        [
                                                                                    7.531859885777559,
                                                                                    6.597521431586985
                                                                        ],
                                                                        [
                                                                                    7.531994744130353,
                                                                                    6.597493056819915
                                                                        ]
                                                            ]
                                                ]
                                    }
                        },
                        {
                                    "type": "Feature",
                                    "properties": {
                                                "Text": "P25",
                                                "Shape_Area": 450.762775373,
                                                "area": "450 sqm"
                                    },
                                    "geometry": {
                                                "type": "Polygon",
                                                "coordinates": [
                                                            [
                                                                        [
                                                                                    7.531050737309143,
                                                                                    6.597691679356238
                                                                        ],
                                                                        [
                                                                                    7.530976032926795,
                                                                                    6.59743418200727
                                                                        ],
                                                                        [
                                                                                    7.530840509615684,
                                                                                    6.597463576411524
                                                                        ],
                                                                        [
                                                                                    7.530910091361599,
                                                                                    6.59770341357994
                                                                        ],
                                                                        [
                                                                                    7.53093395691104,
                                                                                    6.597716249283503
                                                                        ],
                                                                        [
                                                                                    7.530945396599548,
                                                                                    6.597713843136048
                                                                        ],
                                                                        [
                                                                                    7.531050737309143,
                                                                                    6.597691679356238
                                                                        ]
                                                            ]
                                                ]
                                    }
                        },
                        {
                                    "type": "Feature",
                                    "properties": {
                                                "Text": "P10",
                                                "Shape_Area": 443.198471066,
                                                "area": "443 sqm"
                                    },
                                    "geometry": {
                                                "type": "Polygon",
                                                "coordinates": [
                                                            [
                                                                        [
                                                                                    7.531145194399074,
                                                                                    6.598017257861851
                                                                        ],
                                                                        [
                                                                                    7.53107053470597,
                                                                                    6.59775991799219
                                                                        ],
                                                                        [
                                                                                    7.530972603267836,
                                                                                    6.59778052285354
                                                                        ],
                                                                        [
                                                                                    7.530942570731086,
                                                                                    6.597815366433709
                                                                        ],
                                                                        [
                                                                                    7.531004267236058,
                                                                                    6.598028027258704
                                                                        ],
                                                                        [
                                                                                    7.531039692545692,
                                                                                    6.598039455536584
                                                                        ],
                                                                        [
                                                                                    7.531145194399074,
                                                                                    6.598017257861851
                                                                        ]
                                                            ]
                                                ]
                                    }
                        },
                        {
                                    "type": "Feature",
                                    "properties": {
                                                "Text": "P11",
                                                "Shape_Area": 450.267015044,
                                                "area": "450 sqm"
                                    },
                                    "geometry": {
                                                "type": "Polygon",
                                                "coordinates": [
                                                            [
                                                                        [
                                                                                    7.531280052890162,
                                                                                    6.597988883327461
                                                                        ],
                                                                        [
                                                                                    7.531205393123951,
                                                                                    6.597731543463253
                                                                        ],
                                                                        [
                                                                                    7.53107053470597,
                                                                                    6.59775991799219
                                                                        ],
                                                                        [
                                                                                    7.531145194399074,
                                                                                    6.598017257861851
                                                                        ],
                                                                        [
                                                                                    7.531280052890162,
                                                                                    6.597988883327461
                                                                        ]
                                                            ]
                                                ]
                                    }
                        },
                        {
                                    "type": "Feature",
                                    "properties": {
                                                "Text": "P12",
                                                "Shape_Area": 450.267015038,
                                                "area": "450 sqm"
                                    },
                                    "geometry": {
                                                "type": "Polygon",
                                                "coordinates": [
                                                            [
                                                                        [
                                                                                    7.531414911373627,
                                                                                    6.597960508753141
                                                                        ],
                                                                        [
                                                                                    7.531340251534295,
                                                                                    6.597703168894371
                                                                        ],
                                                                        [
                                                                                    7.531205393123951,
                                                                                    6.597731543463253
                                                                        ],
                                                                        [
                                                                                    7.531280052890162,
                                                                                    6.597988883327461
                                                                        ],
                                                                        [
                                                                                    7.531414911373627,
                                                                                    6.597960508753141
                                                                        ]
                                                            ]
                                                ]
                                    }
                        },
                        {
                                    "type": "Feature",
                                    "properties": {
                                                "Text": "P13",
                                                "Shape_Area": 450.267671381,
                                                "area": "450 sqm"
                                    },
                                    "geometry": {
                                                "type": "Polygon",
                                                "coordinates": [
                                                            [
                                                                        [
                                                                                    7.531549769844123,
                                                                                    6.597932135947533
                                                                        ],
                                                                        [
                                                                                    7.531475109937015,
                                                                                    6.597674794285578
                                                                        ],
                                                                        [
                                                                                    7.531340251534295,
                                                                                    6.597703168894371
                                                                        ],
                                                                        [
                                                                                    7.531414911373627,
                                                                                    6.597960508753141
                                                                        ],
                                                                        [
                                                                                    7.531549769844123,
                                                                                    6.597932135947533
                                                                        ]
                                                            ]
                                                ]
                                    }
                        },
                        {
                                    "type": "Feature",
                                    "properties": {
                                                "Text": "P14",
                                                "Shape_Area": 450.269995658,
                                                "area": "450 sqm"
                                    },
                                    "geometry": {
                                                "type": "Polygon",
                                                "coordinates": [
                                                            [
                                                                        [
                                                                                    7.531684628312314,
                                                                                    6.597903761293359
                                                                        ],
                                                                        [
                                                                                    7.531609968332094,
                                                                                    6.597646419636843
                                                                        ],
                                                                        [
                                                                                    7.531475109937015,
                                                                                    6.597674794285578
                                                                        ],
                                                                        [
                                                                                    7.531549769844123,
                                                                                    6.597932135947533
                                                                        ],
                                                                        [
                                                                                    7.531684628312314,
                                                                                    6.597903761293359
                                                                        ]
                                                            ]
                                                ]
                                    }
                        },
                        {
                                    "type": "Feature",
                                    "properties": {
                                                "Text": "P15",
                                                "Shape_Area": 450.267671403,
                                                "area": "450 sqm"
                                    },
                                    "geometry": {
                                                "type": "Polygon",
                                                "coordinates": [
                                                            [
                                                                        [
                                                                                    7.53181948677288,
                                                                                    6.597875386599273
                                                                        ],
                                                                        [
                                                                                    7.531744826714215,
                                                                                    6.597618046756802
                                                                        ],
                                                                        [
                                                                                    7.531609968332094,
                                                                                    6.597646419636843
                                                                        ],
                                                                        [
                                                                                    7.531684628312314,
                                                                                    6.597903761293359
                                                                        ],
                                                                        [
                                                                                    7.53181948677288,
                                                                                    6.597875386599273
                                                                        ]
                                                            ]
                                                ]
                                    }
                        },
                        {
                                    "type": "Feature",
                                    "properties": {
                                                "Text": "P16",
                                                "Shape_Area": 450.261328562,
                                                "area": "450 sqm"
                                    },
                                    "geometry": {
                                                "type": "Polygon",
                                                "coordinates": [
                                                            [
                                                                        [
                                                                                    7.531954343417152,
                                                                                    6.597847011859918
                                                                        ],
                                                                        [
                                                                                    7.531879683285378,
                                                                                    6.597589672022907
                                                                        ],
                                                                        [
                                                                                    7.531744826714215,
                                                                                    6.597618046756802
                                                                        ],
                                                                        [
                                                                                    7.53181948677288,
                                                                                    6.597875386599273
                                                                        ],
                                                                        [
                                                                                    7.531954343417152,
                                                                                    6.597847011859918
                                                                        ]
                                                            ]
                                                ]
                                    }
                        },
                        {
                                    "type": "Feature",
                                    "properties": {
                                                "Text": "P17",
                                                "Shape_Area": 450.267015044,
                                                "area": "450 sqm"
                                    },
                                    "geometry": {
                                                "type": "Polygon",
                                                "coordinates": [
                                                            [
                                                                        [
                                                                                    7.532089201862441,
                                                                                    6.597818637085979
                                                                        ],
                                                                        [
                                                                                    7.532014541657568,
                                                                                    6.597561297254394
                                                                        ],
                                                                        [
                                                                                    7.531879683285378,
                                                                                    6.597589672022907
                                                                        ],
                                                                        [
                                                                                    7.531954343417152,
                                                                                    6.597847011859918
                                                                        ],
                                                                        [
                                                                                    7.532089201862441,
                                                                                    6.597818637085979
                                                                        ]
                                                            ]
                                                ]
                                    }
                        },
                        {
                                    "type": "Feature",
                                    "properties": {
                                                "Text": "P39",
                                                "Shape_Area": 449.500273034,
                                                "area": "449 sqm"
                                    },
                                    "geometry": {
                                                "type": "Polygon",
                                                "coordinates": [
                                                            [
                                                                        [
                                                                                    7.530976032926795,
                                                                                    6.59743418200727
                                                                        ],
                                                                        [
                                                                                    7.530900772986898,
                                                                                    6.597176802394833
                                                                        ],
                                                                        [
                                                                                    7.530795986190696,
                                                                                    6.597198848427634
                                                                        ],
                                                                        [
                                                                                    7.530771253783549,
                                                                                    6.597224861562995
                                                                        ],
                                                                        [
                                                                                    7.530840509615684,
                                                                                    6.597463576411524
                                                                        ],
                                                                        [
                                                                                    7.530976032926795,
                                                                                    6.59743418200727
                                                                        ]
                                                            ]
                                                ]
                                    }
                        },
                        {
                                    "type": "Feature",
                                    "properties": {
                                                "Text": "P24",
                                                "Shape_Area": 450.542238706,
                                                "area": "450 sqm"
                                    },
                                    "geometry": {
                                                "type": "Polygon",
                                                "coordinates": [
                                                            [
                                                                        [
                                                                                    7.531185595707728,
                                                                                    6.597663304828743
                                                                        ],
                                                                        [
                                                                                    7.531110891252233,
                                                                                    6.597405807485211
                                                                        ],
                                                                        [
                                                                                    7.530976032926795,
                                                                                    6.59743418200727
                                                                        ],
                                                                        [
                                                                                    7.531050737309143,
                                                                                    6.597691679356238
                                                                        ],
                                                                        [
                                                                                    7.531185595707728,
                                                                                    6.597663304828743
                                                                        ]
                                                            ]
                                                ]
                                    }
                        },
                        {
                                    "type": "Feature",
                                    "properties": {
                                                "Text": "P71",
                                                "Shape_Area": 450.541516447,
                                                "area": "450 sqm"
                                    },
                                    "geometry": {
                                                "type": "Polygon",
                                                "coordinates": [
                                                            [
                                                                        [
                                                                                    7.530864312425135,
                                                                                    6.596557921236816
                                                                        ],
                                                                        [
                                                                                    7.530939572317023,
                                                                                    6.596815302644677
                                                                        ],
                                                                        [
                                                                                    7.531074430467078,
                                                                                    6.596786928095139
                                                                        ],
                                                                        [
                                                                                    7.530999170496737,
                                                                                    6.596529548501516
                                                                        ],
                                                                        [
                                                                                    7.530864312425135,
                                                                                    6.596557921236816
                                                                        ]
                                                            ]
                                                ]
                                    }
                        }
            ]
};

        // Nearby Locations Data
        const locationsData = {"type":"FeatureCollection","name":"Locations","crs":{"type":"name","properties":{"name":"urn:ogc:def:crs:OGC:1.3:CRS84"}},"features":[{"type":"Feature","properties":{"id":null,"Labels":"Civil Defense Estate"},"geometry":{"type":"Point","coordinates":[7.561622605358441,6.597827049498076]}},{"type":"Feature","properties":{"id":null,"Labels":"Pilgrimage Centre"},"geometry":{"type":"Point","coordinates":[7.570356758222593,6.601503984073124]}},{"type":"Feature","properties":{"id":null,"Labels":"Timber Market Ugwuogo"},"geometry":{"type":"Point","coordinates":[7.556860489794349,6.602536101151153]}},{"type":"Feature","properties":{"id":null,"Labels":"Nationa Housing Estate"},"geometry":{"type":"Point","coordinates":[7.553624415808748,6.601880277007075]}},{"type":"Feature","properties":{"id":null,"Labels":"Seaman Global Estate"},"geometry":{"type":"Point","coordinates":[7.533688468379058,6.600891163539954]}},{"type":"Feature","properties":{"id":null,"Labels":"Breeze Garden Estate"},"geometry":{"type":"Point","coordinates":[7.529207750552842,6.597160467792579]}},{"type":"Feature","properties":{"id":null,"Labels":"Behold Gardens Estate"},"geometry":{"type":"Point","coordinates":[7.523287575067476,6.59936448452741]}}]};

        // Estates Data
        const estatesData = {"type":"FeatureCollection","name":"Estates","crs":{"type":"name","properties":{"name":"urn:ogc:def:crs:OGC:1.3:CRS84"}},"features":[{"type":"Feature","properties":{"id":null,"Label":"Himalayas Estate"},"geometry":{"type":"MultiPolygon","coordinates":[[[[7.554122273344987,6.595010198113789],[7.554587661911476,6.595827301690963],[7.554641776861067,6.596332615070988],[7.55491235160903,6.597224975738758],[7.555139634397314,6.597192721766715],[7.555182926356989,6.597407748207328],[7.555009758518294,6.597472256121313],[7.555009758518294,6.597526012709884],[7.555150457387235,6.59823559913228],[7.55531280223601,6.59820334522604],[7.559706936142881,6.597429250846256],[7.559620352223533,6.596719663268847],[7.564101070049751,6.596268107008616],[7.564555635626323,6.599063448673627],[7.565789456477019,6.598955935824363],[7.56760771878331,6.599816037964968],[7.568560141896128,6.593107201665696],[7.565075139142404,6.58973124648985],[7.563408398694973,6.588484072522417],[7.558559699211529,6.59213957355127],[7.556503331127035,6.593859800004433],[7.555832305752092,6.594139336239209],[7.555832305752092,6.594139336239209],[7.554122273344987,6.595010198113789]]]]}},{"type":"Feature","properties":{"id":null,"Label":"FRSC Estate"},"geometry":{"type":"MultiPolygon","coordinates":[[[[7.54903546808334,6.586656311905511],[7.551524755764572,6.585043576358317],[7.552780222595104,6.58409743573158],[7.553884167566782,6.582742731240158],[7.555334448215845,6.578657092139343],[7.56031302357831,6.583301816081439],[7.55814842559463,6.585731677499477],[7.556395101227851,6.586656311905511],[7.553710999728086,6.59072038223407],[7.551957675361307,6.591279458086351],[7.551957675361307,6.591279458086351],[7.54903546808334,6.586656311905511]]]]}},{"type":"Feature","properties":{"id":null,"Label":"Trade More Estate"},"geometry":{"type":"MultiPolygon","coordinates":[[[[7.53625351698971,6.59717121911752],[7.536350923898975,6.594816673385018],[7.536805489475548,6.592913676193908],[7.537454868870651,6.593074947425646],[7.538212478164941,6.593042693183494],[7.538558813842329,6.593451246762332],[7.539651935824086,6.593634020622794],[7.539922510572048,6.594160839019973],[7.541188800392501,6.594397369546765],[7.54187064875736,6.593913556984904],[7.54267155001132,6.593773788823557],[7.543212699507241,6.594085579283228],[7.544717095105898,6.594730662370196],[7.547087329898027,6.594322109845939],[7.547834116202396,6.594709159614159],[7.548764893335378,6.594773667879473],[7.549046291073254,6.595537015048117],[7.548570079516847,6.595795047627935],[7.544868616964755,6.596891684593063],[7.541177977402582,6.597149716467395],[7.537076064223507,6.597214224414979],[7.53625351698971,6.59717121911752]]]]}}]};

        // Additional Locations Data
        const locations2Data = {"type":"FeatureCollection","name":"Locations_2","crs":{"type":"name","properties":{"name":"urn:ogc:def:crs:OGC:1.3:CRS84"}},"features":[{"type":"Feature","properties":{"id":null,"Label_2":"Nike Lake Hotel"},"geometry":{"type":"Point","coordinates":[7.512421293189335,6.508690701806003]}},{"type":"Feature","properties":{"id":null,"Label_2":"Elim Estate"},"geometry":{"type":"Point","coordinates":[7.526675170911866,6.542486971462122]}},{"type":"Feature","properties":{"id":null,"Label_2":"Police Station"},"geometry":{"type":"Point","coordinates":[7.529337626431789,6.555228529300881]}},{"type":"Feature","properties":{"id":null,"Label_2":"Ogbeke-Nike"},"geometry":{"type":"Point","coordinates":[7.536946188344425,6.576237947886173]}},{"type":"Feature","properties":{"id":null,"Label_2":"Ugwuogo-Nike"},"geometry":{"type":"Point","coordinates":[7.55676308288501,6.624758349433057]}},{"type":"Feature","properties":{"id":null,"Label_2":"Fr. Mbaka-Rapha Farms"},"geometry":{"type":"Point","coordinates":[7.508957936415447,6.597977567823587]}}]};

        // Roads Data
        const roadsData = {"type":"FeatureCollection","name":"Roads","crs":{"type":"name","properties":{"name":"urn:ogc:def:crs:OGC:1.3:CRS84"}},"features":[{"type":"Feature","properties":{"id":null,"Name_2":"Ugwuogo Nike - Opi Road"},"geometry":{"type":"MultiLineString","coordinates":[[[7.524088476321365,6.5397235696009],[7.526318012244556,6.543400933694801],[7.526740108851374,6.54411059733389],[7.526999860609417,6.544594458327878],[7.527183851438028,6.545185843350574],[7.527963106712154,6.548271786559884],[7.528720716006441,6.551637270818645],[7.529278099987238,6.554088791386193],[7.529499971280567,6.554744678617577],[7.529786780513404,6.555459702239378],[7.529987005826894,6.555841406159031],[7.53029546103957,6.556384392921466],[7.531139654253204,6.557766049639834],[7.53246005902325,6.559916480491953],[7.534391962723682,6.563050716836318],[7.537119356183119,6.567512803155707],[7.539965802531657,6.572093120030704],[7.541085981988209,6.573985445206135],[7.542709430475969,6.5765658770194],[7.544614276701607,6.579662377509107],[7.546778874685287,6.583188924000781],[7.5493763922657,6.587446550410292],[7.552114608715057,6.591876163348669],[7.553391721525428,6.593940435472977],[7.554019454940694,6.595133838873187],[7.554387436597919,6.59596169359768],[7.55479871021482,6.597520637051312],[7.555707841367966,6.601520110919041],[7.555902655186494,6.602412462239655],[7.555967593126007,6.602944646900061],[7.555983827610884,6.603460704206126],[7.556021708075598,6.604944365963617],[7.556140760964703,6.610567188615495],[7.556238167873966,6.615114854999612],[7.556335574783234,6.618189612808855],[7.556346397773152,6.619232445900396],[7.556346397773152,6.619834492867943],[7.556238167873966,6.620468791557382],[7.555751133327639,6.623027479689823]]]}}]};

        // Global variables
        let map;
        let parcelLayers = [];
        let currentBaseLayer = 'satellite';
        let parcelStatus = {}; // Local cache - NOT the source of truth
        let googleSheetsData = {}; // REAL source of truth from Google Sheets
        let parcelDatabase = {}; // ENHANCED: Complete parcel database with buyer info
        
        // ENHANCED: Intelligent price formatting function
        function formatPrice(priceValue) {
            if (!priceValue) return '‚Ç¶0';
            
            // Remove commas and any other formatting FIRST
            const cleanPrice = String(priceValue).replace(/[^0-9.]/g, '');
            const num = parseFloat(cleanPrice);
            if (isNaN(num)) return '‚Ç¶0';
            
            // If number is less than 1000, it's likely in thousands (like 450 for 450 sqm area, or 12 for 12M)
            // Numbers >= 1000 are already in full naira amount
            if (num > 0 && num < 1000) {
                return '‚Ç¶' + (num * 1000000).toLocaleString();
            }
            
            // If it's already a large number (e.g., 3500000), format and display as-is
            return '‚Ç¶' + num.toLocaleString();
        }
        
        // ENHANCED: Get complete parcel data from database
        function getParcelData(parcelId) {
            return parcelDatabase[parcelId] || {
                status: 'available',
                purchaserName: '',
                phoneNumber: '',
                emailAddress: '',
                purchaseId: '',
                displayPreference: 'none',
                areaSqm: '',
                priceNaira: '',
                saleDate: '',
                serviceFeeDue: 0,
                paymentStatus: ''
            };
        }
        
        // Get REAL parcel status from Google Sheets data (source of truth)
        function getRealParcelStatus(parcelId) {
            // First check Google Sheets data (the real database)
            if (googleSheetsData[parcelId]) {
                return googleSheetsData[parcelId];
            }
            
            // Fallback to local cache
            return parcelStatus[parcelId] || 'available';
        }
        
        // Landscape orientation variables
        let isLandscape = false;
        let controlsVisible = false;
        let landscapeTimeout;
        
        // Initialize parcel status from localStorage or set defaults
        function initializeParcelStatus() {
            const saved = localStorage.getItem('madoxParcelStatusWGS84');
            if (saved) {
                parcelStatus = JSON.parse(saved);
            } else {
                // Set default status for all parcels
                subdivisionData.features.forEach(feature => {
                    const parcelId = feature.properties.Text.trim();
                    parcelStatus[parcelId] = 'available';
                });
                saveParcelStatus();
            }
        }
        
        function saveParcelStatus() {
            localStorage.setItem('madoxParcelStatusWGS84', JSON.stringify(parcelStatus));
        }
        
        // Get parcel color based on status
        function getParcelColor(parcelId) {
            const status = getRealParcelStatus(parcelId);
            switch (status) {
                case 'available': return '#28a745';
                case 'reserved': return '#ffc107';
                case 'sold': return '#dc3545';
                default: return '#6c757d';
            }
        }
        
        // Initialize the map
        function initMap() {
            console.log("Initializing map with WGS84 data...");
            console.log("Total parcels:", subdivisionData.features.length);
            
            // Calculate bounds of the subdivision
            const bounds = L.geoJSON(subdivisionData).getBounds();
            const center = bounds.getCenter();
            
            console.log("Subdivision center:", center);
            console.log("Subdivision bounds:", bounds);
            
            // Create map with increased zoom limits
            map = L.map('map', {
                maxZoom: 25,  // Allow much closer zoom
                minZoom: 10   // Prevent zooming out too far
            }).setView([center.lat, center.lng], 18);
            
            // Base layers with increased maxZoom
            const mapLayer = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: ' OpenStreetMap contributors',
                maxZoom: 25,
                maxNativeZoom: 19  // OSM tiles go up to 19, but we'll allow digital zoom beyond
            });
            
            const satelliteLayer = L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
                attribution: 'Tiles ¬© Esri ‚Äî Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community',
                maxZoom: 25,
                maxNativeZoom: 20  // Esri satellite tiles go up to 20, allow digital zoom beyond
            });
            
            // Add initial layer
            satelliteLayer.addTo(map);
            
            // Add parcels to map
            loadParcels();
            
            // Add nearby locations and estates
            addNearbyLocations();
            addAdditionalLocations();
            addRoads();
            addEstates();
            
            // Zoom to subdivision
            map.fitBounds(bounds, { padding: [20, 20] });
            
            // Populate admin dropdown
            populateParcelDropdown();
            addParcelControls();
            
            // Add zoom event listener for responsive labels
            map.on('zoomend', function() {
                createParcelLabels();
            });
            
            // Create parcel labels after map is fully loaded
            setTimeout(() => {
                createParcelLabels();
            }, 500);
            
            // Hide loading screen
            document.getElementById('loading').style.display = 'none';
            
            console.log("Map initialization complete!");
        }
        
        function loadParcels() {
            console.log("Loading parcels...");
            
            // Clear existing layers
            parcelLayers.forEach(layer => map.removeLayer(layer));
            parcelLayers = [];
            
            // Add each parcel as a separate layer
            subdivisionData.features.forEach((feature, index) => {
                const parcelId = feature.properties.Text.trim();
                const area = feature.properties.Shape_Area;
                const perimeter = feature.properties.Shape_Leng;
                const status = getRealParcelStatus(parcelId);
                
                console.log(`Loading parcel ${parcelId} (${index + 1}/${subdivisionData.features.length})`);
                
                const layer = L.geoJSON(feature, {
                    style: {
                        fillColor: getParcelColor(parcelId),
                        weight: 2,
                        opacity: 1,
                        color: '#ffffff',
                        dashArray: '3',
                        fillOpacity: 0.7
                    },
                    onEachFeature: function(feature, layer) {
                        // Get center coordinates for this parcel
                        const parcelBounds = layer.getBounds();
                        const parcelCenter = parcelBounds.getCenter();
                        
                        // Create popup content with fresh data
                        layer.bindPopup('Loading parcel information...'); // Initial placeholder
                        
                        // Set up click handler to load fresh data
                        layer.on('click', async function() {
                            try {
                                const popupContent = await createEnhancedPopup(feature);
                                layer.setPopupContent(popupContent);
                            } catch (error) {
                                console.log('Error loading popup data:', error);
                                layer.setPopupContent('Error loading parcel information');
                            }
                        });
                        
                        // Highlight on hover
                        layer.on('mouseover', function() {
                            layer.setStyle({
                                weight: 4,
                                color: '#fff',
                                dashArray: '',
                                fillOpacity: 0.9
                            });
                        });
                        
                        layer.on('mouseout', function() {
                            layer.setStyle({
                                weight: 2,
                                color: '#ffffff',
                                dashArray: '3',
                                fillOpacity: 0.7
                            });
                        });
                        
                        // Double-click to select parcel in admin panel
                        layer.on('dblclick', function() {
                            const parcelSelect = document.getElementById('parcelSelect');
                            const statusSelect = document.getElementById('statusSelect');
                            if (parcelSelect && statusSelect) {
                                parcelSelect.value = parcelId;
                                statusSelect.value = status;
                                layer.openPopup();
                            }
                        });
                    }
                }).addTo(map);
                
                parcelLayers.push(layer);
            });
            
            console.log(`Loaded ${parcelLayers.length} parcels successfully!`);
            
            // üåç AUTO-LOAD PUBLIC PARCEL STATUSES FOR ALL USERS
            setTimeout(() => {
                loadPublicParcelStatuses(false); // Initial load without indicator
                
                // üîÑ SET UP AUTOMATIC REFRESH EVERY 30 SECONDS FOR ALL USERS
                setInterval(() => {
                    console.log('üîÑ Auto-refreshing parcel statuses...');
                    loadPublicParcelStatuses(true); // Show indicator for auto-refresh
                }, 30000); // Refresh every 30 seconds
                
            }, 1000); // Small delay to ensure parcels are fully rendered
            
            // Recreate parcel labels
            createParcelLabels();
        }
        
        // Add nearby locations to map
        function addNearbyLocations() {
            L.geoJSON(locationsData, {
                pointToLayer: function(feature, latlng) {
                    return L.marker(latlng, {
                        icon: L.divIcon({
                            className: 'location-square',
                            html: '<div style="width: 6px; height: 6px; background-color: white; border: 1px solid #722F37;"></div>',
                            iconSize: [6, 6],
                            iconAnchor: [3, 3]
                        })
                    });
                },
                onEachFeature: function(feature, layer) {
                    if (feature.properties && feature.properties.Labels) {
                        // Add popup
                        layer.bindPopup(`
                            <div style="text-align: center; padding: 5px;">
                                <strong style="color: #8B0000;">${feature.properties.Labels}</strong><br>
                                <small style="color: #666;">Nearby Location</small>
                            </div>
                        `);
                        
                        // Add dark ash label directly on point
                        const labelMarker = L.marker(layer.getLatLng(), {
                            icon: L.divIcon({
                                className: 'location-label',
                                html: `<div style="color: #4A4A4A; font-weight: 600; font-size: 8px; text-shadow: 1px 1px 2px rgba(255,255,255,0.9), -1px -1px 2px rgba(255,255,255,0.9), 1px -1px 2px rgba(255,255,255,0.9), -1px 1px 2px rgba(255,255,255,0.9);">${feature.properties.Labels}</div>`,
                                iconAnchor: [0, -8],
                                iconSize: [0, 0]
                            }),
                            interactive: false,
                            zIndexOffset: 100
                        });
                        
                        labelMarker.addTo(map);
                    }
                }
            }).addTo(map);
        }
        
        // Add estates to map with white boundaries
        function addEstates() {
            L.geoJSON(estatesData, {
                style: function(feature) {
                    return {
                        color: '#FFFFFF',
                        weight: 2,
                        opacity: 0.7,
                        dashArray: '6,6',
                        fill: false
                    };
                },
                onEachFeature: function(feature, layer) {
                    if (feature.properties && feature.properties.Label) {
                        // Add popup
                        layer.bindPopup(`
                            <div style="text-align: center; padding: 8px;">
                                <strong style="color: #8B0000; font-size: 14px;">${feature.properties.Label.toUpperCase()}</strong><br>
                                <small style="color: #666;">Residential Estate</small>
                            </div>
                        `);
                        
                        // Add capital letters label spread across center of polygon
                        const center = layer.getBounds().getCenter();
                        
                        // Special positioning for TradeMore Estate to center it better
                        let labelCenter = center;
                        if (feature.properties.Label && feature.properties.Label.toLowerCase().includes('trademore')) {
                            // Shift TradeMore label more towards the center of the estate
                            labelCenter = L.latLng(center.lat - 0.0002, center.lng - 0.0002);
                        }
                        
                        const estateLabel = L.marker(labelCenter, {
                            icon: L.divIcon({
                                className: 'estate-label',
                                html: `<div style="color: #4A4A4A; font-weight: bold; font-size: 10px; text-shadow: 1px 1px 2px rgba(255,255,255,0.9), -1px -1px 2px rgba(255,255,255,0.9), 1px -1px 2px rgba(255,255,255,0.9), -1px 1px 2px rgba(255,255,255,0.9); letter-spacing: 2px; text-transform: uppercase;">${feature.properties.Label}</div>`,
                                iconAnchor: [0, 0],
                                iconSize: [0, 0]
                            }),
                            interactive: false,
                            zIndexOffset: 150
                        });
                        
                        estateLabel.addTo(map);
                    }
                }
            }).addTo(map);
        }
        
        // Add additional locations (Locations_2) to map
        function addAdditionalLocations() {
            L.geoJSON(locations2Data, {
                pointToLayer: function(feature, latlng) {
                    return L.marker(latlng, {
                        icon: L.divIcon({
                            className: 'location-square',
                            html: '<div style="width: 6px; height: 6px; background-color: white; border: 1px solid #722F37;"></div>',
                            iconSize: [6, 6],
                            iconAnchor: [3, 3]
                        })
                    });
                },
                onEachFeature: function(feature, layer) {
                    if (feature.properties && feature.properties.Label_2) {
                        // Add popup
                        layer.bindPopup(`
                            <div style="text-align: center; padding: 5px;">
                                <strong style="color: #8B0000;">${feature.properties.Label_2}</strong><br>
                                <small style="color: #666;">Nearby Location</small>
                            </div>
                        `);
                        
                        // Add dark ash label directly on point
                        const labelMarker = L.marker(layer.getLatLng(), {
                            icon: L.divIcon({
                                className: 'location-label',
                                html: `<div style="color: #4A4A4A; font-weight: 600; font-size: 8px; text-shadow: 1px 1px 2px rgba(255,255,255,0.9), -1px -1px 2px rgba(255,255,255,0.9), 1px -1px 2px rgba(255,255,255,0.9), -1px 1px 2px rgba(255,255,255,0.9);">${feature.properties.Label_2}</div>`,
                                iconAnchor: [0, -8],
                                iconSize: [0, 0]
                            }),
                            interactive: false,
                            zIndexOffset: 100
                        });
                        
                        labelMarker.addTo(map);
                    }
                }
            }).addTo(map);
        }
        
        // Add roads to map with line labels
        function addRoads() {
            L.geoJSON(roadsData, {
                style: function(feature) {
                    return {
                        color: '#FFD700',           // Golden yellow color for visibility
                        weight: 4,                  // Bold line similar to major roads
                        opacity: 0.9,
                        dashArray: '0',             // Solid line (no dashes)
                        lineCap: 'round',
                        lineJoin: 'round'
                    };
                },
                onEachFeature: function(feature, layer) {
                    if (feature.properties && feature.properties.Name_2) {
                        // Add popup
                        layer.bindPopup(`
                            <div style="text-align: center; padding: 8px;">
                                <strong style="color: #B8860B; font-size: 12px;">${feature.properties.Name_2}</strong><br>
                                <small style="color: #666;">Major Road</small>
                            </div>
                        `);
                        
                        // Add road label along the line with smaller font size
                        const coordinates = feature.geometry.coordinates;
                        let labelPoint, rotation = 0;
                        
                        if (feature.geometry.type === 'LineString') {
                            // Find midpoint of the line
                            const midIndex = Math.floor(coordinates.length / 2);
                            labelPoint = L.latLng(coordinates[midIndex][1], coordinates[midIndex][0]);
                            
                            // Calculate rotation angle based on line direction
                            if (coordinates.length > 1) {
                                const start = coordinates[Math.max(0, midIndex - 1)];
                                const end = coordinates[Math.min(coordinates.length - 1, midIndex + 1)];
                                const dx = end[0] - start[0];
                                const dy = end[1] - start[1];
                                // Fix rotation calculation - swap dx and dy for proper alignment
                                rotation = Math.atan2(dy, dx) * 180 / Math.PI;
                                // Add 45 degree adjustment for better road alignment
                                rotation += 45;
                                // Fine-tune with 3 degrees clockwise
                                rotation += 3;
                                // Additional 5 degrees clockwise adjustment
                                rotation += 5;
                                // Another 5 degrees clockwise adjustment
                                rotation += 5;
                                // Final 3 degrees clockwise for perfect alignment
                                rotation += 3;
                                
                                // Ensure text is always readable (not upside down)
                                if (rotation > 90 || rotation < -90) {
                                    rotation += 180;
                                }
                            }
                        } else if (feature.geometry.type === 'MultiLineString') {
                            // Handle MultiLineString - use first LineString
                            const firstLine = coordinates[0];
                            const midIndex = Math.floor(firstLine.length / 2);
                            labelPoint = L.latLng(firstLine[midIndex][1], firstLine[midIndex][0]);
                            
                            // Calculate rotation angle
                            if (firstLine.length > 1) {
                                const start = firstLine[Math.max(0, midIndex - 1)];
                                const end = firstLine[Math.min(firstLine.length - 1, midIndex + 1)];
                                const dx = end[0] - start[0];
                                const dy = end[1] - start[1];
                                // Fix rotation calculation - swap dx and dy for proper alignment
                                rotation = Math.atan2(dy, dx) * 180 / Math.PI;
                                // Add 45 degree adjustment for better road alignment
                                rotation += 45;
                                // Fine-tune with 3 degrees clockwise
                                rotation += 3;
                                // Additional 5 degrees clockwise adjustment
                                rotation += 5;
                                // Another 5 degrees clockwise adjustment
                                rotation += 5;
                                // Final 3 degrees clockwise for perfect alignment
                                rotation += 3;
                                
                                if (rotation > 90 || rotation < -90) {
                                    rotation += 180;
                                }
                            }
                        } else {
                            // Fallback to bounds center for other geometries
                            const bounds = layer.getBounds();
                            labelPoint = bounds.getCenter();
                        }
                        
                        // Create road label with smaller font size
                        const roadLabel = L.marker(labelPoint, {
                            icon: L.divIcon({
                                className: 'road-label',
                                html: `<div style="
                                    color: #2C3E50; 
                                    font-weight: bold; 
                                    font-size: 9px; 
                                    text-shadow: 1px 1px 2px rgba(255,255,255,0.9), -1px -1px 2px rgba(255,255,255,0.9), 1px -1px 2px rgba(255,255,255,0.9), -1px 1px 2px rgba(255,255,255,0.9);
                                    text-transform: uppercase;
                                    letter-spacing: 0.3px;
                                    white-space: nowrap;
                                    font-family: Arial, sans-serif;
                                    transform: rotate(${rotation}deg);
                                    transform-origin: center center;
                                    pointer-events: none;
                                ">${feature.properties.Name_2}</div>`,
                                iconAnchor: [0, 0],
                                iconSize: [0, 0]
                            }),
                            interactive: false,
                            zIndexOffset: 200
                        });
                        
                        roadLabel.addTo(map);
                    }
                }
            }).addTo(map);
        }

        function populateParcelDropdown() {
            const select = document.getElementById('parcelSelect');
            select.innerHTML = '<option value="">Select Parcel...</option>';
            
            subdivisionData.features.forEach(feature => {
                const parcelId = cleanParcelNumber(feature.properties.Text);
                const option = document.createElement('option');
                option.value = parcelId;
                option.textContent = `Parcel ${parcelId}`;
                select.appendChild(option);
            });
        }
        
        function toggleLayer(layerType) {
            const mapBtn = document.getElementById('mapBtn');
            const satelliteBtn = document.getElementById('satelliteBtn');
            
            // Remove only tile layers, preserve GeoJSON layers
            map.eachLayer(layer => {
                if (layer._url && (layer._url.includes('openstreetmap') || layer._url.includes('arcgisonline'))) {
                    map.removeLayer(layer);
                }
            });
            
            if (layerType === 'map') {
                const mapLayer = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    attribution: ' OpenStreetMap contributors',
                    maxZoom: 19
                });
                mapLayer.addTo(map);
                
                mapBtn.classList.add('active');
                satelliteBtn.classList.remove('active');
                currentBaseLayer = 'map';
            } else if (layerType === 'satellite') {
                const satelliteLayer = L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
                    attribution: 'Tiles ¬© Esri ‚Äî Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community',
                    maxZoom: 19
                });
                satelliteLayer.addTo(map);
                
                satelliteBtn.classList.add('active');
                mapBtn.classList.remove('active');
                currentBaseLayer = 'satellite';
            }
            
            // Force map refresh for mobile
            setTimeout(() => {
                map.invalidateSize();
            }, 100);
        }
        
        let userLocationMarker = null;
        
        function locateUser() {
            // Prevent multiple simultaneous location requests
            if (window.locationRequestInProgress) {
                return;
            }
            
            if (navigator.geolocation) {
                window.locationRequestInProgress = true;
                const locationButton = document.querySelector('button[onclick="locateUser()"]');
                locationButton.textContent = '?? Locating...';
                locationButton.disabled = true;
                
                navigator.geolocation.getCurrentPosition(function(position) {
                    const lat = position.coords.latitude;
                    const lng = position.coords.longitude;
                    
                    // Remove existing user marker if it exists
                    if (userLocationMarker) {
                        map.removeLayer(userLocationMarker);
                    }
                    
                    // Add user location marker with RED PIN
                    userLocationMarker = L.marker([lat, lng], {
                        icon: L.divIcon({
                            className: 'user-location-pin',
                            html: `<div style="
                                color: #ff0000;
                                font-size: 24px;
                                text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
                                transform: translate(-50%, -100%);
                            ">??</div>`,
                            iconSize: [24, 24],
                            iconAnchor: [12, 24]
                        })
                    }).addTo(map);
                    
                    userLocationMarker.bindPopup(`
                        <div class="parcel-popup">
                            <h3 style="color: #ff0000;">üìç Your Location</h3>
                            <p><strong>Latitude:</strong> ${lat.toFixed(6)}</p>
                            <p><strong>Longitude:</strong> ${lng.toFixed(6)}</p>
                            <p><em>Red pin shows your current location</em></p>
                        </div>
                    `).openPopup();
                    
                    // Center map on user location
                    map.setView([lat, lng], Math.max(map.getZoom(), 16));
                    
                    // Reset button
                    locationButton.textContent = 'üìç My Location';
                    locationButton.disabled = false;
                    window.locationRequestInProgress = false;
                    
                    console.log('User located at:', lat, lng);
                }, function(error) {
                    alert('Unable to get your location. Please enable location services.');
                    locationButton.textContent = 'üìç My Location';
                    locationButton.disabled = false;
                    window.locationRequestInProgress = false;
                });
            } else {
                alert('Geolocation is not supported by this browser.');
            }
        }
        
        function zoomToSubdivision() {
            const bounds = L.geoJSON(subdivisionData).getBounds();
            map.fitBounds(bounds, { padding: [20, 20] });
            
            // Show popup message about landmarks
            setTimeout(() => {
                const popup = L.popup()
                    .setLatLng(map.getCenter())
                    .setContent(`
                        <div style="text-align: center; padding: 10px;">
                            <h4 style="color: #2c5f3f; margin: 0 0 8px 0;">üèòÔ∏è Viewing Silverstone Estate Ogbeke</h4>
                            <p style="margin: 0; font-size: 12px;">Zoom out to see surrounding landmarks and roads</p>
                        </div>
                    `)
                    .openOn(map);
                
                // Auto-close popup after 3 seconds
                setTimeout(() => {
                    map.closePopup(popup);
                }, 3000);
            }, 500);
        }
        
        function selectParcel() {
            const select = document.getElementById('parcelSelect');
            const statusSelect = document.getElementById('statusSelect');
            const parcelId = select.value;
            
            if (parcelId) {
                // Update status dropdown to current parcel status
                statusSelect.value = getRealParcelStatus(parcelId);
                
                // Find and highlight the parcel
                const feature = subdivisionData.features.find(f => f.properties.Text.trim() === parcelId);
                if (feature) {
                    const bounds = L.geoJSON(feature).getBounds();
                    map.fitBounds(bounds, { padding: [50, 50] });
                    
                    // Find and open popup for this parcel
                    parcelLayers.forEach(layer => {
                        layer.eachLayer(sublayer => {
                            if (sublayer.feature && sublayer.feature.properties.Text.trim() === parcelId) {
                                sublayer.openPopup();
                            }
                        });
                    });
                }
            }
        }
        
        function updateParcelStatus() {
            const parcelSelect = document.getElementById('parcelSelect');
            const statusSelect = document.getElementById('statusSelect');
            const parcelId = parcelSelect.value;
            const newStatus = statusSelect.value;
            
            if (parcelId) {
                console.log(`üìù Admin requesting change: ${parcelId} ‚Üí ${newStatus} (TEMPORARY until Google Sheets sync)`);
                
                // TEMPORARY local update (will be overridden by Google Sheets)
                parcelStatus[parcelId] = newStatus;
                saveParcelStatus();
                
                // Track when local change was made
                localStorage.setItem('lastLocalChange', new Date().toISOString());
                
                // Immediately update Google Sheets for admin changes (no double authentication)
                updateGoogleSheets(parcelId, newStatus, 'Admin');
                
                // Show temporary visual update with warning
                showTemporaryStatusUpdate(parcelId, newStatus);
            }
        }
        
        function showTemporaryStatusUpdate(parcelId, newStatus) {
            // Show popup warning this is temporary
            const popup = L.popup()
                .setLatLng(map.getCenter())
                .setContent(`
                    <div class="parcel-popup">
                        <h3>‚è≥ Temporary Status Update</h3>
                        <p>Parcel ${parcelId} ‚Üí <strong>${newStatus}</strong></p>
                        <div style="background: #fff3cd; padding: 8px; border-radius: 4px; border-left: 3px solid #ffc107; margin-top: 8px;">
                            <p style="margin: 0; font-size: 12px; color: #856404;">
                                ‚ö†Ô∏è This change is TEMPORARY<br>
                                üíæ Update Google Sheets to make it permanent<br>
                                üîÑ Use "Admin Sync" to confirm changes
                            </p>
                        </div>
                    </div>
                `)
                .openOn(map);
                
            setTimeout(() => {
                map.closePopup(popup);
            }, 6000);
        }
        
        // Quiet sync for customers (no UI feedback)
        async function syncWithGoogleSheetsQuiet() {
            try {
                const response = await fetch(
                    `https://sheets.googleapis.com/v4/spreadsheets/${GOOGLE_SHEETS_CONFIG.spreadsheetId}/values/${GOOGLE_SHEETS_CONFIG.sheetName}!A2:L?key=${GOOGLE_SHEETS_CONFIG.apiKey}`
                );
                
                if (response.ok) {
                    const data = await response.json();
                    if (data.values && data.values.length > 0) {
                        const updatedCount = updateStatusFromSheets(data.values);
                        if (updatedCount > 0) {
                            loadParcels(); // Refresh map silently
                            console.log(`Background sync: Updated ${updatedCount} parcels from Google Sheets`);
                        }
                    }
                }
            } catch (error) {
                console.log('Background sync failed (this is normal):', error.message);
            }
        }
        
        // Helper function to calculate parcel row number in Google Sheets
        async function getParcelRowNumber(parcelId) {
            try {
                // Fetch current sheet data to find row number
                const response = await fetch(`https://sheets.googleapis.com/v4/spreadsheets/${GOOGLE_SHEETS_CONFIG.spreadsheetId}/values/${GOOGLE_SHEETS_CONFIG.sheetName}?key=${GOOGLE_SHEETS_CONFIG.apiKey}`);
                
                if (response.ok) {
                    const data = await response.json();
                    const rows = data.values || [];
                    
                    // Find the row index (0-based) + 2 (header row + 1-based indexing)
                    for (let i = 1; i < rows.length; i++) { // Start from 1 to skip header
                        if (rows[i][0] === parcelId) {
                            return i + 1; // Convert to 1-based row number
                        }
                    }
                }
                
                // If not found in existing data, estimate based on parcel ID
                return estimateRowNumber(parcelId);
            } catch (error) {
                console.log('Could not determine exact row, using estimation');
                return estimateRowNumber(parcelId);
            }
        }
        
        // Fallback function to estimate row number based on parcel ID patterns
        function estimateRowNumber(parcelId) {
            if (parcelId.match(/^\d+$/)) {
                // Numeric parcels (1, 2, 3, etc.) - assume they start at row 2
                return parseInt(parcelId) + 1;
            } else if (parcelId.startsWith('P')) {
                // P-series parcels (P15, P16, etc.) - estimate based on number
                const num = parseInt(parcelId.substring(1));
                return num - 15 + 15 + 1; // Adjust based on your data structure
            } else if (parcelId === 'OS1') {
                // Open space - typically at the end
                return 47; // Adjust based on your actual data
            }
            return null; // Can't estimate
        }
        
        // Enhanced push to track admin changes
        async function pushStatusToGoogleSheets(parcelId, newStatus) {
            console.log(`Admin changed ${parcelId} to ${newStatus} - should update Google Sheets`);
            
            const currentDate = new Date().toISOString().split('T')[0];
            
            // Show enhanced reminder to update Google Sheets with tracking info
            const syncStatus = document.getElementById('syncStatus');
            if (syncStatus) {
                syncStatus.innerHTML = `
                    üìä <strong>Update Required:</strong> Please update your Google Sheet:<br>
                    ÔøΩ <strong>Parcel:</strong> ${parcelId}<br>
                    ÔøΩ <strong>New Status:</strong> ${newStatus}<br>
                    ÔøΩ <strong>Date:</strong> ${currentDate}<br>
                    ÔøΩ <strong>Changed By:</strong> Admin<br><br>
                    <a href="${GOOGLE_SHEETS_CONFIG.sheetUrl}#gid=0&range=A" target="_blank" 
                       onclick="openSheetAtParcel('${parcelId}'); return false;"
                       style="background: #28a745; color: white; padding: 8px 16px; text-decoration: none; border-radius: 5px;">
                       üìä Open Sheet ‚Üí Find ${parcelId}
                    </a>
                    <br><small>üìù Update columns: Status | LastUpdated | ChangedBy | AdminApproved</small>
                `;
                syncStatus.style.display = 'block';
                syncStatus.style.background = '#e8f4fd';
                syncStatus.style.color = '#0c5460';
                syncStatus.style.padding = '15px';
                syncStatus.style.borderRadius = '8px';
                syncStatus.style.border = '1px solid #bee5eb';
                
                setTimeout(() => {
                    syncStatus.style.display = 'none';
                }, 20000); // Show for 20 seconds
            }
        }
        
        // Function to open Google Sheet at specific parcel row
        async function openSheetAtParcel(parcelId) {
            const rowNumber = await getParcelRowNumber(parcelId);
            let sheetUrl;
            
            if (rowNumber) {
                // Open sheet with specific row highlighted
                sheetUrl = `${GOOGLE_SHEETS_CONFIG.sheetUrl}#gid=0&range=A${rowNumber}:L${rowNumber}`;
                console.log(`Opening sheet at row ${rowNumber} for parcel ${parcelId}`);
            } else {
                // Fallback to regular sheet URL
                sheetUrl = GOOGLE_SHEETS_CONFIG.sheetUrl;
                console.log(`Opening sheet (row not found) for parcel ${parcelId}`);
            }
            
            window.open(sheetUrl, '_blank');
        }
        
        // ===== NEW FEATURES: SEARCH, CONTACT MODAL, WHATSAPP =====
        
        function searchParcel(event) {
            const searchTerm = event.target.value.toLowerCase().trim();
            
            if (event.key === 'Enter' && searchTerm) {
                // Find matching parcel
                const feature = subdivisionData.features.find(f => 
                    f.properties.Text.toLowerCase().trim().includes(searchTerm)
                );
                
                if (feature) {
                    const bounds = L.geoJSON(feature).getBounds();
                    map.fitBounds(bounds, { padding: [50, 50] });
                    
                    // Open popup for found parcel
                    parcelLayers.forEach(layer => {
                        layer.eachLayer(sublayer => {
                            if (sublayer.feature && 
                                sublayer.feature.properties.Text.toLowerCase().trim().includes(searchTerm)) {
                                sublayer.openPopup();
                            }
                        });
                    });
                } else {
                    alert('Parcel not found. Try searching for "A1", "B5", etc.');
                }
            }
        }
        
        // Land view toggle - makes parcels transparent to view underlying terrain
        let landViewActive = false;
        
        function toggleLandView() {
            const landBtn = document.getElementById('landBtn');
            landViewActive = !landViewActive;
            
            if (landViewActive) {
                // Make all parcel polygons 95% transparent with more defined outlines
                parcelLayers.forEach(layer => {
                    if (layer.setStyle) {
                        layer.setStyle({
                            fillOpacity: 0.05,  // 95% transparent (was 0.1)
                            opacity: 0.9        // 10% more opaque outline (was 0.1)
                        });
                    }
                });
                landBtn.classList.add('active');
                landBtn.innerHTML = 'üó∫Ô∏è Land ‚úì';
            } else {
                // Restore original opacity
                parcelLayers.forEach(layer => {
                    if (layer.setStyle) {
                        layer.setStyle({
                            fillOpacity: 0.7,
                            opacity: 1
                        });
                    }
                });
                landBtn.classList.remove('active');
                landBtn.innerHTML = 'üó∫Ô∏è Land';
            }
        }
        
        // Auto-resize search input based on content
        function resizeSearchInput(input) {
            // Create a temporary span to measure text width
            const span = document.createElement('span');
            span.style.visibility = 'hidden';
            span.style.position = 'absolute';
            span.style.fontSize = window.getComputedStyle(input).fontSize;
            span.style.fontFamily = window.getComputedStyle(input).fontFamily;
            span.style.padding = '0';
            span.style.margin = '0';
            span.style.whiteSpace = 'nowrap';
            
            // Use placeholder text if input is empty, otherwise use actual value
            const text = input.value || input.placeholder;
            span.textContent = text;
            
            document.body.appendChild(span);
            const textWidth = span.offsetWidth;
            document.body.removeChild(span);
            
            // Set input width with some padding (minimum 80px for usability)
            input.style.width = Math.max(textWidth + 20, 80) + 'px';
        }
        
        let currentSelectedParcel = null;
        
        function openContactModal(parcelId) {
            currentSelectedParcel = parcelId;
            document.getElementById('modalParcelId').textContent = parcelId;
            document.getElementById('contactModal').style.display = 'flex';
            
            // Clear form
            document.getElementById('contactForm').reset();
        }
        
        function closeContactModal() {
            document.getElementById('contactModal').style.display = 'none';
            currentSelectedParcel = null;
        }
        
        function submitContactForm(event) {
            event.preventDefault();
            
            const name = document.getElementById('contactName').value;
            const phone = document.getElementById('contactPhone').value;
            const email = document.getElementById('contactEmail').value;
            const message = document.getElementById('contactMessage').value;
            
            const parcelNumber = cleanParcelNumber(currentSelectedParcel);
            
            // Create WhatsApp message to A&Z Projects
            const whatsappMessage = `üè° NEW INQUIRY - Silverstone Estate Ogbeke%0A%0Aüìç Interested in: Parcel ${parcelNumber}%0Aüí∞ Listed Price: ‚Ç¶3,500,000%0A%0Aüë§ Customer Details:%0A‚Ä¢ Name: ${name}%0A‚Ä¢ Phone: ${phone}%0A‚Ä¢ Email: ${email}%0A%0Aüí¨ Message: ${message || 'No additional message'}%0A%0A‚è∞ Inquiry sent: ${new Date().toLocaleString()}`;
            
            // Open WhatsApp to your number
            window.open(`https://wa.me/2348147042804?text=${whatsappMessage}`, '_blank');
            
            // Close modal
            closeContactModal();
            
            // Show success message
            alert('‚úÖ Thank you! Your inquiry has been sent to A&Z Projects via WhatsApp.');
        }
        
        function contactUsDirectly(parcelId) {
            const parcelNumber = cleanParcelNumber(parcelId);
            const status = getRealParcelStatus(parcelId);
            const statusLabel = status.charAt(0).toUpperCase() + status.slice(1);
            
            // Create direct message to your WhatsApp number
            const message = `üè° INQUIRY - Silverstone Estate Ogbeke%0A%0Aüìç Interested in: Parcel ${parcelNumber}%0Aüí∞ Listed Price: ‚Ç¶3,500,000%0Aüìä Status: ${statusLabel}%0A%0Aüëã Hi! I'm interested in this parcel. Please provide more information.%0A%0Aüó∫Ô∏è Source: ${window.location.href}`;
            
            // Open WhatsApp DIRECTLY to your number (not modal, not customer choice)
            window.open(`https://wa.me/2348147042804?text=${message}`, '_blank');
        }
        
        function shareOnWhatsApp(parcelId) {
            const selectedParcel = parcelId || currentSelectedParcel;
            if (!selectedParcel) return;
            
            const parcelNumber = cleanParcelNumber(selectedParcel);
            const message = `üè° Check out this property at Silverstone Estate Ogbeke!%0A%0Aüìç Parcel: ${parcelNumber}%0Aüí∞ Price: ‚Ç¶3,500,000%0Aüåü Premium location with excellent amenities%0A%0Aüó∫Ô∏è View interactive map: ${window.location.href}%0A%0Aüìû Contact us for more info: +234 814 704 2804`;
            window.open(`https://wa.me/?text=${message}`, '_blank');
        }
        
        // Close modal when clicking outside
        document.addEventListener('click', function(event) {
            const modal = document.getElementById('contactModal');
            if (event.target === modal) {
                closeContactModal();
            }
        });
        
        // ===== PARCEL NUMBERING & PRICING ENHANCEMENTS =====
        let parcelLabelsVisible = true;
        let parcelLabels = [];

        // Clean parcel number (keep P prefix, clean whitespace)
        function cleanParcelNumber(txt) {
            if (!txt) return '';
            // Extract just the P and number part, removing extra whitespace
            const match = txt.match(/P\d+/);
            return match ? match[0] : txt.trim();
        }

        // Toggle parcel number visibility
        function toggleParcelNumbers() {
            const btn = document.querySelector('.parcel-number-toggle');
            if (!btn) return;
            
            parcelLabelsVisible = !parcelLabelsVisible;
            console.log('Toggle clicked, parcelLabelsVisible now:', parcelLabelsVisible);
            
            if (parcelLabelsVisible) {
                btn.textContent = 'üëÅÔ∏è Hide Numbers';
                // Show all labels
                parcelLabels.forEach(label => {
                    if (!map.hasLayer(label)) {
                        label.addTo(map);
                    }
                });
                console.log('Parcel numbers shown');
            } else {
                btn.textContent = 'üëÅÔ∏è Show Numbers';
                // Hide all labels
                parcelLabels.forEach(label => {
                    if (map.hasLayer(label)) {
                        map.removeLayer(label);
                    }
                });
                console.log('Parcel numbers hidden');
            }
        }

        // Create parcel number labels on map
        function createParcelLabels() {
            if (!map) {
                console.log('createParcelLabels: map not ready');
                return;
            }
            if (!subdivisionData) {
                console.log('createParcelLabels: subdivision data not ready');
                return;
            }
            
            console.log('Creating parcel labels, visible:', parcelLabelsVisible);
            
            // Remove existing labels
            parcelLabels.forEach(label => {
                if (map.hasLayer(label)) {
                    map.removeLayer(label);
                }
            });
            parcelLabels = [];
            
            // Get current zoom level for responsive sizing
            const zoomLevel = map.getZoom();
            let zoomClass = 'parcel-label-zoom-18'; // default
            if (zoomLevel <= 16) zoomClass = 'parcel-label-zoom-16';
            else if (zoomLevel <= 17) zoomClass = 'parcel-label-zoom-17';
            else if (zoomLevel <= 18) zoomClass = 'parcel-label-zoom-18';
            else if (zoomLevel <= 19) zoomClass = 'parcel-label-zoom-19';
            else if (zoomLevel <= 20) zoomClass = 'parcel-label-zoom-20';
            else if (zoomLevel <= 21) zoomClass = 'parcel-label-zoom-21';
            else if (zoomLevel <= 22) zoomClass = 'parcel-label-zoom-22';
            else if (zoomLevel <= 23) zoomClass = 'parcel-label-zoom-23';
            else if (zoomLevel <= 24) zoomClass = 'parcel-label-zoom-24';
            else zoomClass = 'parcel-label-zoom-25';
            
            console.log('Zoom level:', zoomLevel, 'Class:', zoomClass);
            
            let labelsAdded = 0;
            
            // Create new labels for each parcel
            subdivisionData.features.forEach((feature, index) => {
                try {
                    const bounds = L.geoJSON(feature).getBounds();
                    const center = bounds.getCenter();
                    const parcelNumber = cleanParcelNumber(feature.properties.Text);
                    
                    // Debug first few parcels
                    if (index < 3) {
                        console.log('Parcel', index, 'Raw text:', feature.properties.Text, 'Cleaned:', parcelNumber);
                    }
                    
                    if (parcelNumber) {
                        const label = L.marker([center.lat, center.lng], {
                            icon: L.divIcon({
                                className: `parcel-label ${zoomClass}`,
                                html: parcelNumber,
                                iconSize: [20, 12],
                                iconAnchor: [10, 6]
                            }),
                            interactive: false
                        });
                        
                        if (parcelLabelsVisible) {
                            label.addTo(map);
                            labelsAdded++;
                        }
                        parcelLabels.push(label);
                    }
                } catch (error) {
                    console.error('Error creating label for parcel', index, error);
                }
            });
            
            console.log(`Created ${parcelLabels.length} parcel labels, ${labelsAdded} added to map (zoom: ${zoomLevel}, visible: ${parcelLabelsVisible})`);
        }

        // Add parcel toggle button to map
        function addParcelControls() {
            if (!window.map) return;
            
            const toggleButton = L.control({position: 'topleft'});
            toggleButton.onAdd = function() {
                const div = L.DomUtil.create('div');
                div.innerHTML = '<button class="parcel-number-toggle" onclick="toggleParcelNumbers()">üëÅÔ∏è Hide Numbers</button>';
                return div;
            };
            toggleButton.addTo(map);
            
            console.log('Added parcel toggle button');
        }

        // Create enhanced popup with pricing
        async function createEnhancedPopup(feature) {
            const parcelId = feature.properties.Text.trim();
            const parcelNumber = cleanParcelNumber(parcelId);
            
            // ENHANCED: Always fetch fresh data from Google Sheets for popup
            try {
                await loadPublicParcelStatuses(); // Refresh data before showing popup
            } catch (error) {
                console.log('Could not refresh data, using cached data');
            }
            
            // Get enhanced parcel data from database (now freshly loaded)
            const parcelData = getParcelData(parcelId);
            const status = getRealParcelStatus(parcelId);
            const statusLabel = status.charAt(0).toUpperCase() + status.slice(1);
            
            // Use database area and price if available, otherwise fallback to feature properties
            const area = parcelData.areaSqm ? `${parcelData.areaSqm} sqm` : (feature.properties.area || '450 sqm');
            const price = parcelData.priceNaira ? formatPrice(parcelData.priceNaira) : (feature.properties.price || '‚Ç¶3,500,000');
            
            // DEBUG: Log what's happening with the price
            console.log(`üè° Popup for ${parcelId}:`);
            console.log(`   Raw priceNaira from DB: "${parcelData.priceNaira}"`);
            console.log(`   Formatted price shown: "${price}"`);
            
            // Calculate center coordinates for this parcel
            const parcelBounds = L.geoJSON(feature).getBounds();
            const parcelCenter = parcelBounds.getCenter();
            
            // Set current selected parcel for share function
            currentSelectedParcel = parcelId;
            
            // ENHANCED: Generate buyer information based on privacy preference (mobile-friendly)
            let buyerInfo = '';
            if (status === 'sold' || status === 'reserved') {
                const displayPref = parcelData.displayPreference;
                
                if (displayPref === 'name' && parcelData.purchaserName) {
                    buyerInfo = `<p><strong>üë§ Owned by:</strong> ${parcelData.purchaserName}</p>`;
                } else if (displayPref === 'purchase_id' && parcelData.purchaseId) {
                    buyerInfo = `<p><strong>üÜî Purchase ID:</strong> ${parcelData.purchaseId}</p>`;
                }
                // If displayPreference is 'none' or empty, show no buyer info
            }
            
            return `
                <div class="parcel-popup">
                    <h3>üè° Parcel ${parcelNumber}</h3>
                    <p><strong>üí∞ Price:</strong> ${price}</p>
                    <p><strong>üìê Area:</strong> ${area}</p>
                    <p><strong>üìä Status:</strong>
                        <span class="status-badge status-${status}">${statusLabel}</span>
                    </p>
                    ${buyerInfo}
                    <p><strong>üìç Coordinates:</strong> ${parcelCenter.lat.toFixed(6)}, ${parcelCenter.lng.toFixed(6)}</p>
                    <hr style="margin: 8px 0;">
                    <div style="text-align: center; margin-top: 8px;">
                        <button onclick="contactUsDirectly('${parcelId}')" 
                                style="background: linear-gradient(135deg, #28a745 0%, #20c997 100%); 
                                       color: white; border: none; padding: 6px 14px; 
                                       border-radius: 6px; cursor: pointer; font-weight: 600; 
                                       margin-right: 6px; font-size: 12px;">
                            üìû Contact Us
                        </button>
                        <button onclick="shareOnWhatsApp('${parcelId}')" 
                                style="background: linear-gradient(135deg, #25d366 0%, #128c7e 100%); 
                                       color: white; border: none; padding: 6px 14px; 
                                       border-radius: 6px; cursor: pointer; font-weight: 600; font-size: 12px;">
                            üì§ Share
                        </button>
                    </div>
                </div>
            `;
        }

        // ===== DUAL-VIEW SYSTEM & GOOGLE SHEETS INTEGRATION =====
        
        let currentView = 'customer'; // 'customer' or 'client'
        let isClientAuthenticated = false;
        const CLIENT_PASSWORD = 'azprojects2025'; // Change this to a secure password
        
        // SIMPLIFIED Google Sheets Configuration - BUSINESS ACCOUNT
        const GOOGLE_SHEETS_CONFIG = {
            spreadsheetId: '1S5DaLtj6ZrZXKfGAuZh2VKjKKDAlHouNYzxn6Sj7UFM', // CORRECTED - Your actual public sheet
            apiKey: 'AIzaSyCkLewazfYqcQ_llw_Adj_mTNK71T2iRL0', // Business API Key - azprojectslimited@gmail.com
            sheetName: 'SILVERSTONE_ESTATE_PARCELS', // UPDATED - New sheet name with all 51 parcels
            sheetUrl: 'https://docs.google.com/spreadsheets/d/1S5DaLtj6ZrZXKfGAuZh2VKjKKDAlHouNYzxn6Sj7UFM/edit?gid=1707318239#gid=1707318239'
        };
        
        // Enhanced Google Sheets Integration with Change Detection
        let lastSyncTime = localStorage.getItem('lastSyncTime') || '2025-08-28';
        let pendingChanges = [];
        
        // Diagnostic function to test Google Sheets connectivity
        async function testGoogleSheetsConnection() {
            console.log('üîç Testing Google Sheets connection...');
            const testUrl = `https://sheets.googleapis.com/v4/spreadsheets/${GOOGLE_SHEETS_CONFIG.spreadsheetId}?key=${GOOGLE_SHEETS_CONFIG.apiKey}`;
            
            try {
                const response = await fetch(testUrl);
                const data = await response.json();
                
                if (response.ok) {
                    console.log('‚úÖ Connection test successful:', data);
                    alert(`‚úÖ Spreadsheet Connection SUCCESS!\n\nSheet Name: ${data.properties?.title || 'Unknown'}\nAvailable Sheets: ${data.sheets?.map(s => s.properties.title).join(', ') || 'None'}\n\nNext step: Check if data range exists...`);
                    
                    // Test data range access
                    const rangeUrl = `https://sheets.googleapis.com/v4/spreadsheets/${GOOGLE_SHEETS_CONFIG.spreadsheetId}/values/${GOOGLE_SHEETS_CONFIG.sheetName}!A1:L100?key=${GOOGLE_SHEETS_CONFIG.apiKey}`;
                    console.log('Testing range access...');
                    
                    const rangeResponse = await fetch(rangeUrl);
                    const rangeData = await rangeResponse.json();
                    
                    if (rangeResponse.ok) {
                        alert(`‚úÖ FULL CONNECTION SUCCESS!\n\nData Found: ${rangeData.values?.length || 0} rows\nReady for sync operations!`);
                    } else {
                        alert(`‚ö†Ô∏è Range Access Issue\n\nSheet exists but can't read data:\n${rangeData.error?.message}\n\nSolution: Import the CSV template first!`);
                    }
                    
                } else {
                    console.error('‚ùå Connection test failed:', data);
                    if (response.status === 400) {
                        alert(`‚ùå API NOT ENABLED (400 Error)\n\nError: ${data.error?.message || 'Bad Request'}\n\nüö® CRITICAL: Google Sheets API is NOT enabled for your API key!\n\nFIX STEPS:\n1. Go to Google Cloud Console\n2. APIs & Services ‚Üí Library\n3. Search "Google Sheets API"\n4. Click ENABLE\n5. Wait 2-3 minutes\n6. Try again\n\nURL: https://console.cloud.google.com/apis/library`);
                    } else if (response.status === 403) {
                        alert(`‚ùå Access Forbidden (403)\n\nError: ${data.error?.message}\n\nFIX: Check API key restrictions\nAdd: file://* to allowed websites`);
                    } else {
                        alert(`‚ùå Connection Failed (${response.status})\n\nError: ${data.error?.message || 'Unknown error'}`);
                    }
                }
            } catch (error) {
                console.error('‚ùå Connection error:', error);
                alert(`‚ùå Network Error\n\nMessage: ${error.message}\n\nCheck internet connection and try again.`);
            }
        }
        
        async function syncWithRealGoogleSheets() {
            console.log('üìä Starting Google Sheets sync...');
            
            // Also show debug on page
            const debugDiv = document.getElementById('syncStatus');
            debugDiv.innerHTML = 'üîÑ Syncing with Google Sheets...';
            debugDiv.style.display = 'block';
            debugDiv.style.background = '#cce7ff';
            debugDiv.style.color = '#004085';
            debugDiv.style.padding = '10px';
            debugDiv.style.borderRadius = '5px';
            
            if (!isClientAuthenticated) {
                console.log('üîí Authentication required for sync');
                debugDiv.innerHTML = 'üîí Authentication required for Google Sheets sync';
                debugDiv.style.background = '#f8d7da';
                debugDiv.style.color = '#721c24';
                return;
            }
            
            try {
                console.log('üìä Fetching data from Google Sheets...');
                
                // Fetch data from Google Sheets
                const url = `https://sheets.googleapis.com/v4/spreadsheets/${GOOGLE_SHEETS_CONFIG.spreadsheetId}/values/${GOOGLE_SHEETS_CONFIG.sheetName}!A2:L?key=${GOOGLE_SHEETS_CONFIG.apiKey}`;
                
                const response = await fetch(url);
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                console.log('üìä Data received, processing changes...');
                
                const data = await response.json();
                console.log('üîç DEBUG: Data from Google Sheets:', data);
                
                debugDiv.innerHTML = `üîç TESTING: Got ${data.values ? data.values.length : 0} rows from Google Sheets`;
                
                if (data.values && data.values.length > 0) {
                    console.log('üîç DEBUG: Processing', data.values.length, 'rows...');
                    debugDiv.innerHTML = `üîç TESTING: Processing ${data.values.length} rows...`;
                    
                    // Detect changes since last sync
                    const changes = detectChanges(data.values);
                    console.log('üîç DEBUG: Detected changes:', changes);
                    
                    debugDiv.innerHTML = `üîç TESTING: Detected ${changes.length} changes`;
                    
                    if (changes.length > 0) {
                        showChangeNotification(changes);
                    }
                    
                    // Update parcel status from Google Sheets
                    const updatedCount = updateStatusFromSheets(data.values);
                    console.log('üîç DEBUG: Updated', updatedCount, 'parcels');
                    
                    // Reload parcels to reflect changes
                    loadParcels();
                    
                    // Update last sync time
                    lastSyncTime = new Date().toISOString();
                    localStorage.setItem('lastSyncTime', lastSyncTime);
                    updateSyncTime();
                    
                    console.log('üîç DEBUG: Showing sync result...');
                    if (changes.length > 0) {
                        document.getElementById('syncStatus').innerHTML = `‚úÖ Sync completed! ${changes.length} new changes from Google Sheets applied to map.`;
                        document.getElementById('syncStatus').style.background = '#d4edda';
                        document.getElementById('syncStatus').style.color = '#155724';
                    } else {
                        document.getElementById('syncStatus').innerHTML = `‚úÖ Sync completed! No new changes in Google Sheets.<br><small>üîÑ Your local admin changes are saved locally. Remember to manually update Google Sheets to share changes.</small>`;
                        document.getElementById('syncStatus').style.background = '#e2e3e5';
                        document.getElementById('syncStatus').style.color = '#383d41';
                    }
                    
                    document.getElementById('syncStatus').style.padding = '10px';
                    document.getElementById('syncStatus').style.borderRadius = '5px';
                    document.getElementById('syncStatus').style.border = '1px solid #c3e6cb';
                    
                    setTimeout(() => {
                        document.getElementById('syncStatus').style.display = 'none';
                    }, 7000);
                } else {
                    console.log('üîç DEBUG: No data found in Google Sheets');
                    document.getElementById('syncStatus').innerHTML = 'üîç No data found in Google Sheets';
                }
                
            } catch (error) {
                console.error('üö® DEBUG: Sync error:', error);
                
                // Enhanced 403 error diagnostics
                if (error.message.includes('403')) {
                    debugDiv.innerHTML = `
                        üö® <strong>403 Forbidden Error</strong><br>
                        <small style="color: #721c24;">
                        <strong>Possible causes:</strong><br>
                        ‚Ä¢ Sheet not publicly readable<br>
                        ‚Ä¢ API key restrictions<br>
                        ‚Ä¢ Wrong sheet ID<br><br>
                        <strong>Quick fixes:</strong><br>
                        1. Make sure your sheet is shared as "Anyone with link can VIEW"<br>
                        2. Check API key has Google Sheets API enabled<br>
                        3. Try removing any domain restrictions on API key<br><br>
                        <a href="${GOOGLE_SHEETS_CONFIG.sheetUrl}" 
                           target="_blank" style="color: #007bff;">üìä Open Your Sheet</a> | 
                        <a href="https://console.cloud.google.com/apis/credentials" 
                           target="_blank" style="color: #007bff;">üîë Check API Key</a>
                        </small>
                    `;
                    debugDiv.style.background = '#f8d7da';
                    debugDiv.style.color = '#721c24';
                } else if (error.message.includes('400')) {
                    debugDiv.innerHTML = `üö® 400 Bad Request: Check your sheet ID and range`;
                    debugDiv.style.background = '#f8d7da';
                    debugDiv.style.color = '#721c24';
                } else {
                    debugDiv.innerHTML = `üö® Sync failed: ${error.message}`;
                    debugDiv.style.background = '#f8d7da';
                    debugDiv.style.color = '#721c24';
                }
                
                // Show the setup modal for 400/403 errors
                if (error.message.includes('400') || error.message.includes('403')) {
                    setTimeout(() => showGoogleSheetsSetup(), 2000);
                }
            }
        }
        
        function detectChanges(sheetData) {
            const changes = [];
            
            sheetData.forEach(row => {
                if (row.length >= 2) {
                    const parcelId = row[0]?.trim();
                    const status = row[1]?.toLowerCase().trim();
                    const lastUpdated = row[2]?.trim() || 'unknown';
                    const changedBy = row[3]?.trim() || 'Database';
                    
                    // Check if the Google Sheets status is different from our local status
                    if (parcelId && status && parcelStatus[parcelId] !== status) {
                        changes.push({
                            parcel: parcelId,
                            oldStatus: parcelStatus[parcelId] || 'unknown',
                            newStatus: status,
                            changedBy: changedBy,
                            date: lastUpdated
                        });
                    }
                }
            });
            
            return changes;
        }
        
        // Secure admin verification function
        async function verifyAdminAndUpdateSheets(parcelId, status) {
            // Create secure admin verification modal
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed; top: 0; left: 0; width: 100%; height: 100%;
                background: rgba(0,0,0,0.8); z-index: 10000; display: flex;
                align-items: flex-start; justify-content: center; 
                overflow-y: auto; padding: 20px 10px;
                box-sizing: border-box;
            `;
            
            modal.innerHTML = `
                <div style="background: white; padding: 30px; border-radius: 10px; max-width: 400px; 
                           width: 100%; margin: auto; min-height: fit-content; max-height: 90vh; 
                           overflow-y: auto; box-sizing: border-box;">
                    <h3 style="color: #dc3545; margin: 0 0 20px 0;">üîí Admin Authentication Required</h3>
                    <p style="margin: 0 0 15px 0;">
                        To change <strong>${parcelId}</strong> to <strong>${status}</strong> as an admin, 
                        please enter the admin security code:
                    </p>
                    <input type="password" id="adminPassword" placeholder="Enter admin security code" 
                           style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 5px; 
                                  font-size: 16px; margin: 10px 0; box-sizing: border-box;" />
                    <div style="color: #666; font-size: 12px; margin: 5px 0 15px 0;">
                        This prevents unauthorized users from claiming admin privileges
                    </div>
                    <div style="display: flex; gap: 10px; justify-content: center; flex-wrap: wrap; 
                               position: sticky; bottom: 0; background: white; padding-top: 10px;">
                        <button onclick="this.parentElement.parentElement.parentElement.remove()" 
                                style="background: #6c757d; color: white; border: none; padding: 12px 20px; 
                                       border-radius: 5px; cursor: pointer; min-width: 100px;">
                            Cancel
                        </button>
                        <button onclick="verifyAdminPassword('${parcelId}', '${status}', this)" 
                                style="background: #dc3545; color: white; border: none; padding: 12px 20px; 
                                       border-radius: 5px; cursor: pointer; min-width: 120px;">
                            üîí Verify & Update
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // Focus on password input
            setTimeout(() => {
                document.getElementById('adminPassword').focus();
                
                // Allow Enter key to submit
                document.getElementById('adminPassword').addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        verifyAdminPassword(parcelId, status, e.target);
                    }
                });
            }, 100);
        }
        
        // Verify admin password and proceed with update
        function verifyAdminPassword(parcelId, status, buttonElement) {
            const password = document.getElementById('adminPassword').value;
            const correctPassword = 'MADOX2024ADMIN'; // Change this to your desired admin password
            
            if (password === correctPassword) {
                // Log the verified admin action
                logAdminAction(parcelId, status);
                
                // Close modal
                buttonElement.parentElement.parentElement.parentElement.remove();
                
                // Proceed with Google Sheets update
                updateGoogleSheets(parcelId, status, 'Admin');
                
                // Show success message
                showSecureUpdateNotification(parcelId, status);
                
            } else {
                // Log failed attempt
                logFailedAdminAttempt(parcelId, status);
                
                // Show error
                const errorDiv = document.createElement('div');
                errorDiv.style.cssText = `
                    color: #dc3545; background: #f8d7da; padding: 8px; 
                    border-radius: 4px; margin: 10px 0; font-size: 14px;
                `;
                errorDiv.textContent = '? Incorrect admin security code. Access denied.';
                
                // Remove any existing error messages
                const existingError = buttonElement.parentElement.parentElement.querySelector('[style*="color: #dc3545"]');
                if (existingError) existingError.remove();
                
                // Insert error message
                buttonElement.parentElement.parentElement.insertBefore(errorDiv, buttonElement.parentElement);
                
                // Clear password field
                document.getElementById('adminPassword').value = '';
                document.getElementById('adminPassword').focus();
                
                // Remove error after 3 seconds
                setTimeout(() => {
                    if (errorDiv.parentElement) errorDiv.remove();
                }, 3000);
            }
        }
        
        // Enhanced logging for admin actions (single authentication)
        function logAdminAction(parcelId, status) {
            const timestamp = new Date().toISOString();
            const userAgent = navigator.userAgent;
            const logEntry = {
                timestamp: timestamp,
                parcel: parcelId,
                newStatus: status,
                action: 'ADMIN_CHANGE',
                authMethod: 'ADMIN_LOGIN_VERIFIED',
                userAgent: userAgent.substring(0, 100),
                sessionId: Date.now(),
                ipHash: btoa(navigator.userAgent + timestamp).substring(0, 10) // Simple fingerprint
            };
            
            // Store in localStorage for audit trail
            let adminLog = JSON.parse(localStorage.getItem('adminSecurityLog') || '[]');
            adminLog.push(logEntry);
            
            // Keep only last 100 entries
            if (adminLog.length > 100) {
                adminLog = adminLog.slice(-100);
            }
            
            localStorage.setItem('adminSecurityLog', JSON.stringify(adminLog));
            console.log('?? Admin action logged:', logEntry);
        }
        
        // Log failed admin attempts for security monitoring
        function logFailedAdminAttempt(parcelId, status) {
            const timestamp = new Date().toISOString();
            const userAgent = navigator.userAgent;
            const logEntry = {
                timestamp: timestamp,
                parcel: parcelId,
                attemptedStatus: status,
                action: 'FAILED_ADMIN_ATTEMPT',
                userAgent: userAgent.substring(0, 100),
                sessionId: Date.now()
            };
            
            // Store failed attempts separately
            let failedLog = JSON.parse(localStorage.getItem('adminFailedAttempts') || '[]');
            failedLog.push(logEntry);
            
            // Keep only last 50 failed attempts
            if (failedLog.length > 50) {
                failedLog = failedLog.slice(-50);
            }
            
            localStorage.setItem('adminFailedAttempts', JSON.stringify(failedLog));
            console.warn('?? Failed admin attempt logged:', logEntry);
        }
        
        // Security audit function (call from console: viewAdminSecurityLog())
        function viewAdminSecurityLog() {
            const adminLog = JSON.parse(localStorage.getItem('adminSecurityLog') || '[]');
            const failedLog = JSON.parse(localStorage.getItem('adminFailedAttempts') || '[]');
            
            console.log('?? ADMIN SECURITY AUDIT LOG');
            console.log('===========================');
            console.log(`? Successful Admin Actions: ${adminLog.length}`);
            console.log(`? Failed Admin Attempts: ${failedLog.length}`);
            console.log('');
            
            if (adminLog.length > 0) {
                console.log('Recent Successful Admin Actions:');
                adminLog.slice(-10).forEach((entry, index) => {
                    console.log(`${adminLog.length - 10 + index + 1}. ${entry.timestamp} - ${entry.parcel} ? ${entry.newStatus}`);
                });
                console.log('');
            }
            
            if (failedLog.length > 0) {
                console.log('Recent Failed Attempts:');
                failedLog.slice(-5).forEach((entry, index) => {
                    console.log(`${failedLog.length - 5 + index + 1}. ${entry.timestamp} - Attempted: ${entry.parcel} ? ${entry.attemptedStatus}`);
                });
            }
            
            return {
                successfulActions: adminLog,
                failedAttempts: failedLog,
                summary: {
                    totalSuccessful: adminLog.length,
                    totalFailed: failedLog.length,
                    lastSuccessful: adminLog.length > 0 ? adminLog[adminLog.length - 1].timestamp : 'None',
                    lastFailed: failedLog.length > 0 ? failedLog[failedLog.length - 1].timestamp : 'None'
                }
            };
        }
        
        // Make security functions globally available for console access
        window.viewAdminSecurityLog = viewAdminSecurityLog;
        
        // Show secure update notification
        function showSecureUpdateNotification(parcelId, status) {
            const notification = L.popup()
                .setLatLng(map.getCenter())
                .setContent(`
                    <div style="padding: 10px; max-width: 300px;">
                        <h4 style="margin: 0 0 8px 0; color: #28a745;">?? Secure Admin Update</h4>
                        <p style="margin: 0 0 8px 0; font-size: 14px;">
                            <strong>${parcelId}</strong> updated to <strong>${status}</strong>
                        </p>
                        <div style="background: #d4edda; padding: 8px; border-radius: 4px; border-left: 3px solid #28a745;">
                            <p style="margin: 0; font-size: 12px; color: #155724;">
                                ? Admin authentication verified
                                <br>?? Secure change authorized
                                <br>?? Manual Google Sheets update required
                            </p>
                        </div>
                    </div>
                `)
                .openOn(map);
                
            setTimeout(() => {
                map.closePopup(notification);
            }, 5000);
        }
        
        // Function to update Google Sheets with admin changes
        async function updateGoogleSheets(parcelId, status, changedBy) {
            try {
                console.log(`?? Attempting Google Sheets update: ${parcelId} -> ${status} (by ${changedBy})`);
                
                // Log admin actions for security audit
                if (changedBy === 'Admin') {
                    logAdminAction(parcelId, status);
                }
                
                // First, find the row for this parcel
                const response = await fetch(
                    `https://sheets.googleapis.com/v4/spreadsheets/${GOOGLE_SHEETS_CONFIG.spreadsheetId}/values/${GOOGLE_SHEETS_CONFIG.sheetName}!A2:L?key=${GOOGLE_SHEETS_CONFIG.apiKey}`
                );
                
                if (!response.ok) {
                    throw new Error(`Failed to read Google Sheets: ${response.status}`);
                }
                
                const data = await response.json();
                let rowIndex = -1;
                
                // Find the row for this parcel
                if (data.values) {
                    data.values.forEach((row, index) => {
                        if (row[0]?.trim() === parcelId) {
                            rowIndex = index + 2; // +2 because arrays are 0-indexed and we start at row 2
                        }
                    });
                }
                
                if (rowIndex === -1) {
                    console.log(`?? Parcel ${parcelId} not found in Google Sheets, showing manual instructions`);
                    showManualUpdateInstructions(parcelId, status, changedBy, new Date().toISOString().split('T')[0]);
                    return;
                }
                
                // Prepare the update data
                const currentDate = new Date().toISOString().split('T')[0];
                const updateData = {
                    range: `${GOOGLE_SHEETS_CONFIG.sheetName}!A${rowIndex}:L${rowIndex}`,
                    majorDimension: 'ROWS',
                    values: [[
                        status,                    // Column B: Status
                        currentDate,              // Column C: LastUpdated  
                        changedBy,               // Column D: ChangedBy
                        'TRUE'                   // Column E: AdminApproved
                    ]]
                };
                
                // Attempt to update Google Sheets using PUT request
                const updateResponse = await fetch(
                    `https://sheets.googleapis.com/v4/spreadsheets/${GOOGLE_SHEETS_CONFIG.spreadsheetId}/values/${updateData.range}?valueInputOption=RAW&key=${GOOGLE_SHEETS_CONFIG.apiKey}`,
                    {
                        method: 'PUT',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(updateData)
                    }
                );
                
                if (!updateResponse.ok) {
                    // Expected: Write operations require OAuth (not just API key)
                    console.log(`?? Google Sheets write requires OAuth authentication (${updateResponse.status}), using manual workflow`);
                    showManualUpdateInstructions(parcelId, status, changedBy, currentDate);
                    return;
                }
                
                // This would only happen if OAuth was properly configured
                console.log(`? Successfully updated Google Sheets for ${parcelId}`);
                showSuccessNotification(parcelId, status, changedBy, currentDate);
                
            } catch (error) {
                console.log(`?? Using manual Google Sheets workflow: ${error.message}`);
                showManualUpdateInstructions(parcelId, status, changedBy, new Date().toISOString().split('T')[0]);
            }
        }
        
        // Success notification for automatic Google Sheets update
        function showSuccessNotification(parcelId, status, changedBy, currentDate) {
            const notification = L.popup()
                .setLatLng(map.getCenter())
                .setContent(`
                    <div style="padding: 10px; max-width: 300px;">
                        <h4 style="margin: 0 0 8px 0; color: #28a745;">? Google Sheets Updated!</h4>
                        <p style="margin: 0 0 8px 0; font-size: 14px;">
                            <strong>${parcelId}</strong> successfully updated to <strong>${status}</strong>
                            ${changedBy === 'Admin' ? '<span style="color: #dc3545; font-weight: bold;"> (by Admin)</span>' : ''}
                        </p>
                        <div style="background: #d4edda; padding: 8px; border-radius: 4px; border-left: 3px solid #28a745;">
                            <p style="margin: 0; font-size: 12px; color: #155724;">
                                ?? Database synchronized automatically
                                <br>? Status: ${status}
                                <br>?? Date: ${currentDate}
                                <br>?? Changed By: <span style="color: ${changedBy === 'Admin' ? '#dc3545' : '#000'}; font-weight: bold;">${changedBy}</span>
                                <br>?? Admin Approved: TRUE
                            </p>
                        </div>
                    </div>
                `)
                .openOn(map);
                
            setTimeout(() => {
                map.closePopup(notification);
            }, 8000);
        }
        
        // Fallback function for manual instructions
        function showManualUpdateInstructions(parcelId, status, changedBy, currentDate) {
            const notification = L.popup()
                .setLatLng(map.getCenter())
                .setContent(`
                    <div style="padding: 10px; max-width: 320px;">
                        <h4 style="margin: 0 0 8px 0; color: #28a745;">? Change Saved Locally</h4>
                        <p style="margin: 0 0 8px 0; font-size: 14px;">
                            <strong>${parcelId}</strong> updated to <strong>${status}</strong>
                            ${changedBy === 'Admin' ? '<span style="color: #dc3545; font-weight: bold;"> (by Admin)</span>' : ''}
                        </p>
                        <div style="background: #e8f4fd; padding: 8px; border-radius: 4px; border-left: 3px solid #0984e3; margin-bottom: 8px;">
                            <p style="margin: 0; font-size: 12px; color: #2d3436; font-weight: bold;">
                                ? Manual Google Sheets Update:
                            </p>
                            <p style="margin: 4px 0 0 0; font-size: 11px; color: #2d3436;">
                                Find row for <strong>${parcelId}</strong> and update:
                                <br>ÔøΩ <strong>Status</strong>: ${status}
                                <br>ÔøΩ <strong>Date</strong>: ${currentDate}
                                <br>ÔøΩ <strong>Changed By</strong>: <span style="color: #dc3545; font-weight: bold;">${changedBy}</span>
                                <br>ÔøΩ <strong>Admin Approved</strong>: ${changedBy === 'Admin' ? 'TRUE' : 'Pending'}
                                ${changedBy === 'Admin' ? '<br><br><strong style="color: #dc3545;">üîí SECURITY NOTE:</strong><br><small style="color: #721c24;">When you select "Admin" in the ChangedBy dropdown, Google Sheets will prompt for the admin password. This prevents unauthorized admin claims.</small>' : ''}
                            </p>
                            <p style="margin: 6px 0 0 0; font-size: 11px;">
                                <a href="${GOOGLE_SHEETS_CONFIG.sheetUrl}" 
                                   target="_blank" style="color: #0984e3; text-decoration: none;">
                                   üìä Open Google Sheets
                                </a>
                            </p>
                        </div>
                        <div style="background: ${changedBy === 'Admin' ? '#ffeef0' : '#fff3cd'}; padding: 6px; border-radius: 4px; border-left: 3px solid ${changedBy === 'Admin' ? '#dc3545' : '#ffc107'};">
                            <p style="margin: 0; font-size: 11px; color: ${changedBy === 'Admin' ? '#721c24' : '#856404'};">
                                ${changedBy === 'Admin' ? '? Admin changes are immediately approved and synchronized' : '??? This keeps all devices synchronized'}
                            </p>
                        </div>
                    </div>
                `)
                .openOn(map);
                
            setTimeout(() => {
                map.closePopup(notification);
            }, 15000); // Reasonable timeout for reading instructions
        }
        
        function showChangeNotification(changes) {
            if (changes.length === 0) return;
            
            let message = `üîî <strong>${changes.length} parcel(s) have been updated:</strong><br><br>`;
            
            changes.forEach(change => {
                const statusColor = {
                    'available': 'üü¢',
                    'reserved': 'üü°', 
                    'sold': 'üî¥'
                };
                
                const isAdminChange = change.changedBy === 'Admin';
                const changedByStyle = isAdminChange ? 'color: #dc3545; font-weight: bold;' : '';
                const adminLabel = isAdminChange ? ' üëë' : '';
                
                message += `üè† <strong>${change.parcel}</strong>: ${statusColor[change.oldStatus] || '‚ö™'} ${change.oldStatus} ‚Üí ${statusColor[change.newStatus] || '‚ö™'} ${change.newStatus} <em>(by <span style="${changedByStyle}">${change.changedBy}${adminLabel}</span>)</em><br>`;
            });
            
            message += `<br><small>These changes are now public for all customers to see.</small>`;
            
            // Create notification modal
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed; top: 0; left: 0; width: 100%; height: 100%;
                background: rgba(0,0,0,0.8); z-index: 10000; display: flex;
                align-items: flex-start; justify-content: center;
                overflow-y: auto; padding: 20px 10px;
                box-sizing: border-box;
            `;
            
            notification.innerHTML = `
                <div style="background: white; padding: 30px; border-radius: 10px; max-width: 500px; 
                           width: 100%; margin: auto; min-height: fit-content; max-height: 90vh; 
                           overflow-y: auto; box-sizing: border-box;">
                    <h3>üìã Change Notification</h3>
                    <div style="margin: 20px 0; max-height: 60vh; overflow-y: auto;">${message}</div>
                    <div style="text-align: center; position: sticky; bottom: 0; background: white; 
                               padding-top: 15px; margin-top: 15px;">
                        <button onclick="this.parentElement.parentElement.parentElement.remove()" 
                                style="background: #007bff; color: white; border: none; padding: 12px 25px; 
                                       border-radius: 5px; cursor: pointer; font-size: 16px; min-width: 150px;">
                            ‚úÖ Acknowledge Changes
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(notification);
        }
        
        function updateStatusFromSheets(sheetData) {
            let updatedCount = 0;
            
            sheetData.forEach(row => {
                if (row.length >= 5) {
                    const parcelId = row[0]?.trim();
                    const newStatus = row[1]?.toLowerCase().trim();
                    const lastUpdated = row[2]?.trim();
                    const changedBy = row[3]?.trim() || 'Database';
                    const adminApproved = row[4]?.trim().toUpperCase();
                    
                    // Only apply changes that are admin approved
                    if (['available', 'reserved', 'sold'].includes(newStatus) && adminApproved === 'YES') {
                        if (parcelStatus[parcelId] !== newStatus) {
                            parcelStatus[parcelId] = newStatus;
                            updatedCount++;
                        }
                    }
                }
            });
            
            // Save to localStorage as backup
            saveParcelStatus();
            
            return updatedCount;
        }
        
        function showGoogleSheetsSetup() {
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed; top: 0; left: 0; width: 100%; height: 100%;
                background: rgba(0,0,0,0.8); z-index: 10000; display: flex;
                align-items: center; justify-content: center;
            `;
            
            modal.innerHTML = `
                <div style="background: white; padding: 30px; border-radius: 10px; max-width: 600px; margin: 20px;">
                    <h3>üìä Google Sheets Setup Required</h3>
                    <p><strong>To enable real-time status sync:</strong></p>
                    <ol>
                        <li>Create a Google Sheet with columns: ParcelID | Status | LastUpdated</li>
                        <li>Get a Google Sheets API key from Google Cloud Console</li>
                        <li>Make the sheet publicly readable or use service account</li>
                        <li>Update the configuration in the code</li>
                    </ol>
                    <p><strong>Sample sheet structure:</strong></p>
                    <pre style="background: #f5f5f5; padding: 10px; border-radius: 5px;">
ParcelID    | Status    | LastUpdated
P001        | available | 2025-08-27
P002        | sold      | 2025-08-27
P003        | reserved  | 2025-08-27</pre>
                    <p><strong>Valid status values:</strong> available, reserved, sold</p>
                    <div style="text-align: center; margin-top: 20px;">
                        <button onclick="this.parentElement.parentElement.parentElement.remove()" 
                                style="background: #007bff; color: white; border: none; padding: 10px 20px; 
                                       border-radius: 5px; cursor: pointer;">Got it!</button>
                        <button onclick="window.open('${GOOGLE_SHEETS_CONFIG.sheetUrl}', '_blank')" 
                                style="background: #28a745; color: white; border: none; padding: 10px 20px; 
                                       border-radius: 5px; cursor: pointer; margin-left: 10px;">Open Sample Sheet</button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
        }
        
        function toggleView() {
            if (currentView === 'customer') {
                // Switch to client view - require authentication
                document.getElementById('clientLogin').style.display = 'flex';
                document.getElementById('clientPassword').focus();
            } else {
                // Switch back to customer view
                switchToCustomerView();
            }
        }
        
        function authenticateClient() {
            const password = document.getElementById('clientPassword').value;
            if (password === CLIENT_PASSWORD) {
                isClientAuthenticated = true;
                switchToClientView();
                closeLogin();
                syncWithGoogleSheets(); // Auto-sync when client logs in
            } else {
                alert('? Incorrect password. Please try again.');
                document.getElementById('clientPassword').value = '';
                document.getElementById('clientPassword').focus();
            }
        }
        
        function handleLoginKeyup(event) {
            if (event.key === 'Enter') {
                authenticateClient();
            }
        }
        
        function closeLogin() {
            document.getElementById('clientLogin').style.display = 'none';
            document.getElementById('clientPassword').value = '';
        }
        
        function switchToClientView() {
            currentView = 'client';
            document.body.className = 'client-view';
            document.getElementById('adminToggle').textContent = '?? Customer';
            console.log('Switched to client view');
        }
        
        function switchToCustomerView() {
            currentView = 'customer';
            isClientAuthenticated = false;
            document.body.className = 'customer-view';
            document.getElementById('adminToggle').textContent = '?? Admin';
            document.getElementById('syncStatus').style.display = 'none';
            console.log('Switched to customer view');
        }
        
        // Google Sheets Integration
        async function syncWithGoogleSheets() {
            console.log('üîÑ Sync with Google Sheets initiated');
            // First check if there are local changes that need to be pushed
            checkForLocalChanges();
            
            // Then sync from Google Sheets
            await syncWithRealGoogleSheets();
        }
        
        function checkForLocalChanges() {
            // Get timestamp of last local change
            const lastLocalChange = localStorage.getItem('lastLocalChange');
            const lastSync = localStorage.getItem('lastSyncTime');
            
            if (lastLocalChange && lastSync && lastLocalChange > lastSync) {
                // There are local changes newer than last sync
                const syncStatus = document.getElementById('syncStatus');
                syncStatus.innerHTML = `
                    üîÑ <strong>Local changes detected!</strong><br>
                    You have made changes in the admin panel that need to be updated in Google Sheets.<br>
                    <small>Sync will check for incoming changes from Google Sheets, but remember to update your sheet with local changes.</small>
                `;
                syncStatus.style.display = 'block';
                syncStatus.style.background = '#fff3cd';
                syncStatus.style.color = '#856404';
                syncStatus.style.padding = '10px';
                syncStatus.style.borderRadius = '5px';
                
                setTimeout(() => {
                    // This will be replaced by the sync result
                }, 2000);
            }
        }
        
        function updateSyncTime() {
            localStorage.setItem('lastSyncTime', new Date().toISOString());
        }
        
        // Test function to demonstrate sync messages
        function testSyncMessages() {
            const syncStatus = document.getElementById('syncStatus');
            const messages = [
                {
                    html: 'üîÑ Testing sync status messages...',
                    bg: '#cce7ff',
                    color: '#004085'
                },
                {
                    html: 'üîÑ <strong>Local changes detected!</strong><br>You have made changes in the admin panel that need to be updated in Google Sheets.<br><small>This is what you should see when you make local changes.</small>',
                    bg: '#fff3cd',
                    color: '#856404'
                },
                {
                    html: '‚úÖ Sync completed! 2 new changes from Google Sheets applied to map.',
                    bg: '#d4edda',
                    color: '#155724'
                },
                {
                    html: '‚úÖ Sync completed! No new changes in Google Sheets. Your local admin changes are current.',
                    bg: '#e2e3e5',
                    color: '#383d41'
                }
            ];
            
            let currentMessage = 0;
            
            function showNextMessage() {
                if (currentMessage < messages.length) {
                    const msg = messages[currentMessage];
                    syncStatus.innerHTML = msg.html;
                    syncStatus.style.display = 'block';
                    syncStatus.style.background = msg.bg;
                    syncStatus.style.color = msg.color;
                    syncStatus.style.padding = '10px';
                    syncStatus.style.borderRadius = '5px';
                    syncStatus.style.border = '1px solid #c3e6cb';
                    
                    currentMessage++;
                    setTimeout(showNextMessage, 3000);
                } else {
                    setTimeout(() => {
                        syncStatus.style.display = 'none';
                    }, 3000);
                }
            }
            
            showNextMessage();
        }
        
        // Simulate Google Sheets API integration
        async function simulateGoogleSheetsSync() {
            return new Promise((resolve) => {
                setTimeout(() => {
                    // Simulate updating some parcel statuses from Google Sheets
                    const sampleUpdates = {
                        'P80': 'sold',
                        'P79': 'reserved',
                        'P78': 'available'
                    };
                    
                    let updatesCount = 0;
                    Object.keys(sampleUpdates).forEach(parcelId => {
                        const cleanId = parcelId.trim();
                        if (parcelStatus[cleanId] !== sampleUpdates[parcelId]) {
                            parcelStatus[cleanId] = sampleUpdates[parcelId];
                            updatesCount++;
                        }
                    });
                    
                    if (updatesCount > 0) {
                        saveParcelStatus();
                        loadParcels(); // Refresh map with new data
                        console.log(`Updated ${updatesCount} parcels from Google Sheets`);
                    }
                    
                    resolve();
                }, 2000); // Simulate 2-second API call
            });
        }
        
        // Attribution Toggle Function
        let attributionVisible = false;
        
        function toggleAttribution() {
            attributionVisible = !attributionVisible;
            const attributionToggle = document.getElementById('attributionToggle');
            
            if (attributionVisible) {
                document.body.classList.add('show-attribution');
                attributionToggle.textContent = '‚ùì';
                attributionToggle.title = 'Hide Attribution';
            } else {
                document.body.classList.remove('show-attribution');
                attributionToggle.textContent = '‚ÑπÔ∏è';
                attributionToggle.title = 'Show Attribution';
            }
        }
        
        // Admin-controlled sync - changes only go public when admin logs in and syncs
        setInterval(() => {
            if (isClientAuthenticated && currentView === 'client') {
                // Only admin can pull changes to make them public
                syncWithGoogleSheets();
            }
        }, 5 * 60 * 1000); // 5 minutes - admin only
        
        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', function() {
            console.log("Page loaded, initializing WGS84 version...");
            initializeParcelStatus();
            initMap();
            initLandscapeMode();
            
            // Initialize search input size
            const searchInput = document.getElementById('parcelSearch');
            if (searchInput) {
                resizeSearchInput(searchInput);
            }
        });
        
        // Landscape Mode Functions
        function initLandscapeMode() {
            // Check orientation on load
            checkOrientation();
            
            // Listen for orientation changes
            window.addEventListener('orientationchange', function() {
                setTimeout(checkOrientation, 100); // Small delay for proper detection
            });
            
            // Listen for resize events (alternative detection)
            window.addEventListener('resize', checkOrientation);
            
            // Add simple touch event listener for landscape mode
            document.addEventListener('touchend', handleLandscapeTouch, { passive: true });
        }
        
        function checkOrientation() {
            // Only apply landscape mode on mobile devices (max-width: 768px)
            const isMobile = window.innerWidth <= 768;
            const isCurrentlyLandscape = isMobile && window.innerWidth > window.innerHeight && window.innerHeight <= 600;
            
            if (isCurrentlyLandscape !== isLandscape) {
                isLandscape = isCurrentlyLandscape;
                
                if (isLandscape) {
                    enterLandscapeMode();
                } else {
                    exitLandscapeMode();
                }
            }
        }
        
        function enterLandscapeMode() {
            console.log('Entering landscape mode');
            
            // Add full-screen landscape styles
            document.body.classList.add('landscape-mode');
            
            // Hide controls initially
            controlsVisible = false;
        }
        
        function exitLandscapeMode() {
            console.log('Exiting landscape mode');
            const controls = document.querySelector('.controls');
            
            // Remove full-screen landscape styles
            document.body.classList.remove('landscape-mode');
            
            // Show controls normally
            controls.classList.remove('show');
            controlsVisible = false;
            
            // Clear any timeouts
            if (landscapeTimeout) {
                clearTimeout(landscapeTimeout);
            }
        }
        
        function handleLandscapeTouch(e) {
            // Only handle touch events in landscape mode on mobile
            if (!isLandscape) return;
            
            // Simple toggle controls on any touch
            toggleControlsInLandscape();
        }
        
        function toggleControlsInLandscape() {
            const controls = document.querySelector('.controls');
            
            if (controlsVisible) {
                // Hide controls
                controls.classList.remove('show');
                controlsVisible = false;
            } else {
                // Show controls
                controls.classList.add('show');
                controlsVisible = true;
                
                // Auto-hide after 4 seconds of inactivity
                if (landscapeTimeout) {
                    clearTimeout(landscapeTimeout);
                }
                
                landscapeTimeout = setTimeout(() => {
                    if (isLandscape && controlsVisible) {
                        controls.classList.remove('show');
                        controlsVisible = false;
                    }
                }, 4000);
            }
        }
        
        // Handle errors
        window.addEventListener('error', function(e) {
            console.error('Error:', e.error);
            document.getElementById('loading').innerHTML = `
                <div class="spinner"></div>
                <p style="color: red;">Error loading map: ${e.error.message}</p>
                <p>Please refresh the page to try again.</p>
            `;
        });

        // OVERRIDE: Replace complex sync with simple working version
        // PUBLIC FUNCTION - Load parcel statuses for all users (no auth needed)
        window.loadPublicParcelStatuses = async function(showIndicator = false) {
            if (showIndicator) {
                // Show subtle update indicator for auto-refresh
                const indicator = document.createElement('div');
                indicator.innerHTML = 'üîÑ Updating...';
                indicator.style.cssText = 'position:fixed;top:10px;right:10px;background:rgba(0,0,0,0.7);color:white;padding:5px 10px;border-radius:15px;font-size:12px;z-index:10000;';
                document.body.appendChild(indicator);
                
                setTimeout(() => {
                    if (indicator.parentNode) {
                        indicator.parentNode.removeChild(indicator);
                    }
                }, 2000);
            }
            
            console.log('üåç Loading public parcel statuses...');
            
            try {
                // FLEXIBLE: Fetch ALL data to detect headers dynamically
                const url = `https://sheets.googleapis.com/v4/spreadsheets/${GOOGLE_SHEETS_CONFIG.spreadsheetId}/values/${GOOGLE_SHEETS_CONFIG.sheetName}?key=${GOOGLE_SHEETS_CONFIG.apiKey}`;
                
                const response = await fetch(url);
                
                if (!response.ok) {
                    console.log('‚ö†Ô∏è Could not load public parcel data - using defaults');
                    return;
                }
                
                const data = await response.json();
                console.log('üìã Public parcel data loaded:', data.values?.length || 0, 'rows');
                
                if (!data.values || data.values.length < 2) {
                    console.log('‚ö†Ô∏è No data rows found (need at least header + 1 data row)');
                    return;
                }
                
                // FLEXIBLE: Auto-detect column positions from header row
                const headers = data.values[0];
                const columnMap = {};
                headers.forEach((header, index) => {
                    const normalized = String(header || '').toLowerCase().trim();
                    columnMap[normalized] = index;
                    console.log(`  Column ${index}: "${header}" ‚Üí normalized: "${normalized}"`);
                });
                
                // Find key columns (flexible matching)
                const parcelIdCol = columnMap['parcelid'] || columnMap['parcel id'] || columnMap['parcel_id'] || columnMap['id'] || 0;
                const statusCol = columnMap['status'] || 1;
                const buyerCol = columnMap['buyer_name'] || columnMap['buyer name'] || columnMap['purchaser_name'] || columnMap['purchaser name'] || 2;
                const phoneCol = columnMap['contact_phone'] || columnMap['phone'] || columnMap['contact phone'] || 3;
                const emailCol = columnMap['email_address'] || columnMap['email'] || columnMap['email address'] || 4;
                const purchaseCol = columnMap['purchase_id'] || columnMap['purchase id'] || columnMap['purchaseid'] || 5;
                const displayCol = columnMap['display_preference'] || columnMap['display preference'] || 6;
                const areaCol = columnMap['area_sqm'] || columnMap['area'] || columnMap['area_sqm'] || 7;
                const priceCol = columnMap['price'] || columnMap['price_naira'] || columnMap['price naira'] || columnMap['pricenaira'] || 8;
                const dateCol = columnMap['sale_date'] || columnMap['date'] || columnMap['sale date'] || 9;
                const feeCol = columnMap['service_fee_due'] || columnMap['fee'] || columnMap['service fee'] || 10;
                const paymentCol = columnMap['payment_status'] || columnMap['payment'] || columnMap['payment status'] || 11;
                
                console.log('‚úÖ Column mapping:', {parcelIdCol, statusCol, priceCol, buyerCol});
                console.log('üîç First 3 rows for debugging:');
                
                let updatedCount = 0;
                
                // FLEXIBLE: Process ALL data rows (not just 51)
                for (let i = 1; i < data.values.length; i++) {
                    const row = data.values[i];
                    if (row.length > 0 && row[parcelIdCol]) {
                        const parcelId = String(row[parcelIdCol] || '').trim();
                        const newStatus = String(row[statusCol] || 'available').toLowerCase().trim();
                        const priceValue = String(row[priceCol] || '').trim();
                        
                        // Log first 3 parcels for debugging
                        if (i <= 3) {
                            console.log(`   Row ${i}: ID=${parcelId}, Status=${newStatus}, Price="${priceValue}"`);
                        }
                        
                        // Allow any status value, not just ['available', 'reserved', 'sold']
                        const oldStatus = parcelStatus[parcelId];
                        
                        // Store in Google Sheets data (the REAL source of truth)
                        googleSheetsData[parcelId] = newStatus;
                        
                        // FLEXIBLE: Store complete database record with ANY data
                        parcelDatabase[parcelId] = {
                            status: newStatus,
                            purchaserName: String(row[buyerCol] || '').trim(),
                            phoneNumber: String(row[phoneCol] || '').trim(),
                            emailAddress: String(row[emailCol] || '').trim(),
                            purchaseId: String(row[purchaseCol] || '').trim(),
                            displayPreference: (String(row[displayCol] || 'none').toLowerCase()).trim(),
                            areaSqm: String(row[areaCol] || '').trim(),
                            priceNaira: priceValue, // Keep as string for flexible formatting
                            saleDate: String(row[dateCol] || '').trim(),
                            serviceFeeDue: parseFloat(row[feeCol]) || 0,
                            paymentStatus: (String(row[paymentCol] || 'pending').toLowerCase()).trim()
                        };
                        
                        // Also update local cache for backwards compatibility
                        if (['available', 'reserved', 'sold'].includes(newStatus)) {
                            parcelStatus[parcelId] = newStatus;
                        }
                        
                        // Update map colors immediately (flexible status handling)
                        const colors = {
                            'available': '#28a745',
                            'reserved': '#ffc107', 
                            'sold': '#dc3545'
                        };
                        const color = colors[newStatus] || '#999999'; // Gray for unknown status
                        
                        // Search through parcelLayers array and their sub-layers
                        parcelLayers.forEach(layer => {
                            if (layer._layers) {
                                Object.values(layer._layers).forEach(subLayer => {
                                    if (subLayer.feature?.properties?.Text === parcelId) {
                                        subLayer.setStyle({
                                            fillColor: color,
                                            color: '#ffffff',
                                            weight: 2,
                                            opacity: 1,
                                            fillOpacity: 0.7
                                        });
                                        updatedCount++;
                                        
                                        // Show change notification for real-time updates
                                        if (showIndicator && oldStatus && oldStatus !== newStatus) {
                                            showChangeNotification({
                                                parcel: parcelId,
                                                oldStatus: oldStatus,
                                                newStatus: newStatus,
                                                changedBy: 'Auto-sync'
                                            });
                                        }
                                    }
                                });
                            }
                        });
                    }
                }
                
                console.log(`‚úÖ Public parcel statuses updated: ${updatedCount} parcels processed`);
                
            } catch (error) {
                console.log('‚ö†Ô∏è Public parcel status loading failed:', error.message);
            }
        };

        // ADMIN FUNCTION - Sync with Google Sheets (requires authentication)
        window.syncWithRealGoogleSheets = async function() {
            console.clear(); // Clear console to see only our logs
            console.log('üîÑ SIMPLE SYNC OVERRIDE STARTING - ONLY VERSION RUNNING...');
            
            const debugDiv = document.getElementById('syncStatus');
            debugDiv.innerHTML = 'üîÑ Reading from Google Sheets...';
            debugDiv.style.display = 'block';
            debugDiv.style.background = '#cce7ff';
            debugDiv.style.color = '#004085';
            debugDiv.style.padding = '10px';
            debugDiv.style.borderRadius = '5px';
            
            if (!isClientAuthenticated) {
                debugDiv.innerHTML = 'üîí Please authenticate first';
                debugDiv.style.background = '#f8d7da';
                debugDiv.style.color = '#721c24';
                return;
            }
            
            try {
                const url = `https://sheets.googleapis.com/v4/spreadsheets/${GOOGLE_SHEETS_CONFIG.spreadsheetId}/values/${GOOGLE_SHEETS_CONFIG.sheetName}!A2:E?key=${GOOGLE_SHEETS_CONFIG.apiKey}`;
                
                console.log('üìû API Call:', url);
                const response = await fetch(url);
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                console.log('üìã Sheet Data rows:', data.values?.length || 0);
                
                if (!data.values || data.values.length === 0) {
                    debugDiv.innerHTML = 'üì≠ No data in Google Sheets';
                    return;
                }
                
                let updatedCount = 0;
                let changes = [];
                
                console.log('üîç STARTING processing...');
                
                // Process each row - SIMPLE VERSION
                for (let i = 0; i < data.values.length; i++) {
                    const row = data.values[i];
                    if (row.length >= 2) {
                        const parcelId = String(row[0]).trim();
                        const newStatus = String(row[1]).toLowerCase().trim();
                        const changedBy = String(row[3] || 'Google Sheets').trim();
                        
                        if (['available', 'reserved', 'sold'].includes(newStatus)) {
                            const oldStatus = parcelStatus[parcelId];
                            
                            if (oldStatus !== newStatus) {
                                console.log(`üîÑ CHANGE: ${parcelId} ${oldStatus} ‚Üí ${newStatus}`);
                                
                                // Store in Google Sheets data (the REAL source of truth)
                                googleSheetsData[parcelId] = newStatus;
                                
                                // Also update local cache for backwards compatibility
                                parcelStatus[parcelId] = newStatus;
                                updatedCount++;
                                
                                // Track for notification
                                changes.push({
                                    parcel: parcelId,
                                    oldStatus: oldStatus || 'unknown',
                                    newStatus: newStatus,
                                    changedBy: changedBy
                                });
                                
                                // DIRECT MAP UPDATE - Use parcelLayers instead of map.eachLayer
                                console.log(`üé® UPDATING MAP for ${parcelId}...`);
                                const colors = {
                                    'available': '#28a745',
                                    'reserved': '#ffc107', 
                                    'sold': '#dc3545'
                                };
                                
                                let found = false;
                                
                                // Search through parcelLayers array and their sub-layers
                                parcelLayers.forEach(layer => {
                                    if (layer._layers) {
                                        Object.values(layer._layers).forEach(subLayer => {
                                            if (subLayer.feature?.properties?.Text === parcelId) {
                                                console.log(`‚úÖ FOUND layer for ${parcelId} - updating to ${colors[newStatus]}`);
                                                subLayer.setStyle({
                                                    fillColor: colors[newStatus],
                                                    color: '#ffffff',
                                                    weight: 2,
                                                    opacity: 1,
                                                    fillOpacity: 0.7
                                                });
                                                found = true;
                                            }
                                        });
                                    }
                                });
                                
                                if (!found) {
                                    console.warn(`‚ùå No layer found for "${parcelId}"`);
                                }
                            }
                        }
                    }
                }
                
                console.log(`‚úÖ SYNC COMPLETE: ${updatedCount} parcels updated`);
                
                // Also reload public view to ensure consistency
                if (updatedCount > 0) {
                    console.log('üîÑ Refreshing public view...');
                    setTimeout(() => {
                        loadPublicParcelStatuses();
                    }, 500);
                }
                
                debugDiv.innerHTML = `‚úÖ Sync complete! ${updatedCount} parcels updated. Public users will see changes immediately.`;
                debugDiv.style.background = '#d4edda';
                debugDiv.style.color = '#155724';
                
                // DEBUG: Always show map ParcelIDs to understand the format
                console.log('üîç DEBUGGING: Checking parcelLayers array...');
                console.log('üîç typeof parcelLayers:', typeof parcelLayers);
                console.log('üîç parcelLayers defined?:', typeof parcelLayers !== 'undefined');
                
                if (typeof parcelLayers !== 'undefined' && parcelLayers) {
                    console.log(`üó∫Ô∏è parcelLayers array length: ${parcelLayers.length}`);
                    
                    let mapParcelIDs = [];
                    let sampleLayerProperties = [];
                    
                    // Check parcelLayers array instead of map.eachLayer
                    parcelLayers.forEach((layer, index) => {
                        if (index < 3) {
                            console.log(`üîß Parcel Layer ${index + 1}:`, layer);
                            console.log(`üîß Layer ${index + 1} structure:`, {
                                hasFeature: !!layer.feature,
                                hasOptions: !!layer.options,
                                hasProperties: !!layer.feature?.properties,
                                layerKeys: Object.keys(layer),
                                featureKeys: layer.feature ? Object.keys(layer.feature) : null,
                                properties: layer.feature?.properties || null,
                                options: layer.options,
                                _layers: layer._layers ? Object.keys(layer._layers) : null,
                                _layersCount: layer._layers ? Object.keys(layer._layers).length : 0
                            });
                            
                            // Check if there are individual features inside _layers
                            if (layer._layers) {
                                const firstLayerKey = Object.keys(layer._layers)[0];
                                if (firstLayerKey) {
                                    const firstSubLayer = layer._layers[firstLayerKey];
                                    console.log(`üîß First sub-layer in ${index + 1}:`, {
                                        hasFeature: !!firstSubLayer.feature,
                                        feature: firstSubLayer.feature,
                                        properties: firstSubLayer.feature?.properties
                                    });
                                }
                            }
                        }
                        
                        // Try to access ParcelID from sub-layers if they exist
                        if (layer._layers) {
                            Object.values(layer._layers).forEach(subLayer => {
                                if (subLayer.feature?.properties) {
                                    // Collect sample properties to see what's available
                                    if (sampleLayerProperties.length < 3) {
                                        sampleLayerProperties.push(subLayer.feature.properties);
                                    }
                                    
                                    // Try different possible ParcelID field names
                                    const parcelId = subLayer.feature.properties.Text ||  // THIS IS THE CORRECT FIELD!
                                                   subLayer.feature.properties.ParcelID || 
                                                   subLayer.feature.properties.parcelId || 
                                                   subLayer.feature.properties.id || 
                                                   subLayer.feature.properties.ID ||
                                                   subLayer.feature.properties.parcel_id ||
                                                   subLayer.feature.properties.PARCEL_ID;
                                    
                                    if (parcelId) {
                                        mapParcelIDs.push(parcelId);
                                    }
                                }
                            });
                        }
                        
                        if (layer.feature?.properties) {
                            // Collect sample properties to see what's available
                            if (sampleLayerProperties.length < 3) {
                                sampleLayerProperties.push(layer.feature.properties);
                            }
                            
                            // Try different possible ParcelID field names
                            const parcelId = layer.feature.properties.ParcelID || 
                                           layer.feature.properties.parcelId || 
                                           layer.feature.properties.id || 
                                           layer.feature.properties.ID ||
                                           layer.feature.properties.parcel_id ||
                                           layer.feature.properties.PARCEL_ID;
                            
                            if (parcelId) {
                                mapParcelIDs.push(parcelId);
                            }
                        }
                    });
                    
                    console.log('üó∫Ô∏è Map ParcelIDs found:', mapParcelIDs.slice(0, 15), '... (showing first 15)');
                    console.log('üîß Sample layer properties:', sampleLayerProperties);
                    console.log('üîß DETAILED properties analysis:');
                    sampleLayerProperties.forEach((props, index) => {
                        console.log(`   Property set ${index + 1}:`, props);
                        console.log(`   Available fields:`, Object.keys(props));
                    });
                } else {
                    console.log('‚ùå parcelLayers is not defined or empty');
                }
                
                console.log('üìã Sheet ParcelIDs we tried to match:', Object.keys(parcelStatus).slice(0, 15));
                
                debugDiv.innerHTML = `‚úÖ SUCCESS! Updated ${updatedCount} parcels`;
                debugDiv.style.background = '#d4edda';
                debugDiv.style.color = '#155724';
                
                if (changes.length > 0) {
                    setTimeout(() => showChangeNotification(changes), 1000);
                }
                
                setTimeout(() => { debugDiv.style.display = 'none'; }, 5000);
                
            } catch (error) {
                console.error('‚ùå Sync failed:', error);
                debugDiv.innerHTML = `‚ùå Sync failed: ${error.message}`;
                debugDiv.style.background = '#f8d7da';
                debugDiv.style.color = '#721c24';
            }
        };

        // Show change notification popup for admin
        function showChangeNotification(changes) {
            if (!changes || changes.length === 0) return;
            
            // Create notification popup
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed; top: 20px; right: 20px; max-width: 400px; min-width: 300px;
                background: linear-gradient(135deg, #007bff 0%, #0056b3 100%);
                color: white; padding: 20px; border-radius: 10px; box-shadow: 0 4px 20px rgba(0,0,0,0.3);
                z-index: 10001; font-family: Arial, sans-serif; font-size: 14px;
                border: 2px solid rgba(255,255,255,0.2); backdrop-filter: blur(10px);
            `;
            
            const changesHtml = Array.isArray(changes) 
                ? changes.map(change => `
                    <div style="background: rgba(255,255,255,0.1); padding: 8px; margin: 5px 0; border-radius: 5px; border-left: 3px solid #ffc107;">
                        <strong>üìç ${change.parcel}</strong><br>
                        <small>
                            ${change.oldStatus} ‚Üí <span style="color: #ffd700;">${change.newStatus}</span><br>
                            Changed by: ${change.changedBy}
                        </small>
                    </div>
                `).join('')
                : `
                    <div style="background: rgba(255,255,255,0.1); padding: 8px; margin: 5px 0; border-radius: 5px; border-left: 3px solid #ffc107;">
                        <strong>üìç ${changes.parcel}</strong><br>
                        <small>
                            ${changes.oldStatus} ‚Üí <span style="color: #ffd700;">${changes.newStatus}</span><br>
                            Changed by: ${changes.changedBy}
                        </small>
                    </div>
                `;
            
            notification.innerHTML = `
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                    <div>
                        <h4 style="margin: 0; color: #ffd700;">üîÑ Sync Changes Detected</h4>
                        <small style="opacity: 0.9;">${Array.isArray(changes) ? changes.length : 1} parcel(s) updated</small>
                    </div>
                    <button onclick="this.parentElement.parentElement.parentElement.remove()" 
                            style="background: rgba(255,255,255,0.2); border: none; color: white; 
                                   padding: 5px 8px; border-radius: 3px; cursor: pointer;">‚úï</button>
                </div>
                ${changesHtml}
                <div style="margin-top: 15px; text-align: center; font-size: 12px; opacity: 0.8;">
                    Map colors updated automatically ‚Ä¢ Changes now visible to all users
                </div>
            `;
            
            document.body.appendChild(notification);
            
            // Auto-remove after 10 seconds
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.parentNode.removeChild(notification);
                }
            }, 10000);
            
            console.log('üì¢ Change notification shown for', Array.isArray(changes) ? changes.length : 1, 'changes');
        }

        console.log('üîß Sync function override installed!');
        
        // ===== ENHANCED DATABASE FUNCTIONS =====
        
        // Show the database panel with complete CRM view
        function showDatabasePanel() {
            console.log('üóÉÔ∏è Opening database panel...');
            const panel = document.getElementById('databasePanel');
            panel.style.display = 'flex';
            generateDatabaseReport();
        }
        
        // Close the database panel
        function closeDatabasePanel() {
            const panel = document.getElementById('databasePanel');
            panel.style.display = 'none';
        }
        
        // Generate complete database report
        function generateDatabaseReport() {
            const body = document.getElementById('databaseBody');
            
            // Calculate summary statistics
            const allParcels = subdivisionData.features.map(f => f.properties.Text.trim());
            const parcelDatabaseKeys = Object.keys(parcelDatabase);
            const soldParcels = parcelDatabaseKeys.filter(id => parcelDatabase[id].status === 'sold');
            const reservedParcels = parcelDatabaseKeys.filter(id => parcelDatabase[id].status === 'reserved');
            const availableParcels = allParcels.filter(id => !parcelDatabase[id] || parcelDatabase[id].status === 'available');
            
            // Calculate revenue with intelligent number detection
            const totalRevenue = soldParcels.reduce((sum, id) => {
                let price = parseFloat(parcelDatabase[id].priceNaira) || 0;
                // If price is small (like 3), it's likely in millions
                if (price > 0 && price < 1000) {
                    price = price * 1000000;
                }
                return sum + price;
            }, 0);
            
            // CASH FLOW ANALYSIS: Calculate Revenue Generated (Sold) and Revenue Expected (Reserved)
            const revenueGenerated = soldParcels.reduce((sum, id) => {
                let price = parseFloat(parcelDatabase[id].priceNaira) || 3500000; // Default to 3.5M if not specified
                if (price > 0 && price < 1000) {
                    price = price * 1000000;
                }
                return sum + price;
            }, 0);
            
            const revenueExpected = reservedParcels.reduce((sum, id) => {
                let price = parseFloat(parcelDatabase[id].priceNaira) || 3500000; // Default to 3.5M if not specified
                if (price > 0 && price < 1000) {
                    price = price * 1000000;
                }
                return sum + price;
            }, 0);
            
            // Calculate potential total revenue (all 51 parcels at Silverstone price)
            const totalParcels = allParcels.length || 51;
            const defaultPrice = 3500000; // Silverstone Estate price
            const totalPotentialRevenue = totalParcels * defaultPrice;
            const remainingRevenuePotential = totalPotentialRevenue - revenueGenerated - revenueExpected;
            
            // Calculate average parcel price
            const averageParcelPrice = soldParcels.length > 0 ? totalRevenue / soldParcels.length : defaultPrice;
            
            // Generate contact list
            const contactList = parcelDatabaseKeys
                .filter(id => parcelDatabase[id].purchaserName)
                .map(id => ({
                    parcelId: id,
                    ...parcelDatabase[id]
                }))
                .sort((a, b) => a.parcelId.localeCompare(b.parcelId));
            
            body.innerHTML = `
                <div class="database-summary">
                    <div class="summary-card">
                        <h4>üí∞ Total Revenue</h4>
                        <div class="value">‚Ç¶${totalRevenue.toLocaleString()}</div>
                    </div>
                    <div class="summary-card">
                        <h4>üè† Total Parcels</h4>
                        <div class="value">${totalParcels}</div>
                    </div>
                    <div class="summary-card">
                        <h4>‚úÖ Sold</h4>
                        <div class="value">${soldParcels.length}</div>
                    </div>
                    <div class="summary-card">
                        <h4>‚è≥ Reserved</h4>
                        <div class="value">${reservedParcels.length}</div>
                    </div>
                    <div class="summary-card">
                        <h4>üü¢ Available</h4>
                        <div class="value">${(totalParcels - soldParcels.length - reservedParcels.length)}</div>
                    </div>
                    <div class="summary-card">
                        <h4>üíµ Expected</h4>
                        <div class="value">‚Ç¶${revenueExpected.toLocaleString()}</div>
                    </div>
                    <div class="summary-card" style="background: linear-gradient(135deg, #d1ecf1 0%, #bee5eb 100%);">
                        <h4 style="color: #0c5460;">üéØ Occupancy</h4>
                        <div class="value" style="color: #0c5460;">${Math.round(((soldParcels.length + reservedParcels.length) / totalParcels) * 100)}%</div>
                        <small style="color: #0c5460; font-size: 10px;">${soldParcels.length + reservedParcels.length} of ${totalParcels}</small>
                    </div>
                    <div class="summary-card" style="background: linear-gradient(135deg, #f8d7da 0%, #f5c6cb 100%);">
                        <h4 style="color: #721c24;">üìä Avg Price</h4>
                        <div class="value" style="color: #721c24;">‚Ç¶${soldParcels.length > 0 ? Math.round(revenueGenerated / soldParcels.length).toLocaleString() : '3,000,000'}</div>
                        <small style="color: #721c24; font-size: 10px;">Per sold parcel</small>
                    </div>
                </div>
                
                <div class="database-summary" style="margin-top: 15px;">
                    <div class="summary-card" style="background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%);">
                        <h4>üìà Revenue Generated</h4>
                        <div class="value" style="color: #155724;">‚Ç¶${revenueGenerated.toLocaleString()}</div>
                        <small style="color: #155724; font-size: 10px;">From ${soldParcels.length} sold parcels</small>
                    </div>
                    <div class="summary-card" style="background: linear-gradient(135deg, #fff3cd 0%, #ffeaa7 100%);">
                        <h4>‚è≥ Revenue Pipeline</h4>
                        <div class="value" style="color: #856404;">‚Ç¶${revenueExpected.toLocaleString()}</div>
                        <small style="color: #856404; font-size: 10px;">From ${reservedParcels.length} reserved parcels</small>
                    </div>
                    <div class="summary-card" style="background: linear-gradient(135deg, #e2e3e5 0%, #d6d8db 100%);">
                        <h4>üéØ Remaining Potential</h4>
                        <div class="value" style="color: #6c757d;">‚Ç¶${remainingRevenuePotential.toLocaleString()}</div>
                        <small style="color: #6c757d; font-size: 10px;">From ${50 - soldParcels.length - reservedParcels.length} available parcels</small>
                    </div>
                </div>
                
                <h4>üìû BUYER CONTACTS & PROPERTY DETAILS</h4>
                <table class="database-table">
                    <thead>
                        <tr>
                            <th>Parcel</th>
                            <th>Status</th>
                            <th>Buyer Name</th>
                            <th>Phone</th>
                            <th>Email</th>
                            <th>Purchase ID</th>
                            <th>Sale Date</th>
                            <th>Price</th>
                            <th>Area (sqm)</th>
                            <th>Privacy Setting</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${contactList.length > 0 ? contactList.map(contact => `
                            <tr>
                                <td><strong>${contact.parcelId}</strong></td>
                                <td><span class="status-badge status-${contact.status}">${contact.status.toUpperCase()}</span></td>
                                <td>${contact.purchaserName || '-'}</td>
                                <td>${contact.phoneNumber || '-'}</td>
                                <td>${contact.emailAddress || '-'}</td>
                                <td>${contact.purchaseId || '-'}</td>
                                <td>${contact.saleDate ? new Date(contact.saleDate).toLocaleDateString() : '-'}</td>
                                <td>${contact.priceNaira ? formatPrice(contact.priceNaira) : '-'}</td>
                                <td>${contact.areaSqm || '450'} sqm</td>
                                <td>${contact.displayPreference || 'none'}</td>
                            </tr>
                        `).join('') : '<tr><td colspan="10" style="text-align: center; color: #666; padding: 20px;">No buyer data available yet. Update Google Sheets to see records.</td></tr>'}
                    </tbody>
                </table>
                
                <div style="margin-top: 20px; padding: 15px; background: #e7f3ff; border-radius: 8px; border-left: 4px solid #007bff;">
                    <h4 style="margin-top: 0; color: #007bff;">ÔøΩ CASH FLOW ANALYSIS</h4>
                    <p><strong>Revenue Realization Rate:</strong> ${((revenueGenerated / totalPotentialRevenue) * 100).toFixed(1)}% (‚Ç¶${revenueGenerated.toLocaleString()} / ‚Ç¶${totalPotentialRevenue.toLocaleString()})</p>
                    <p><strong>Pipeline Conversion:</strong> ${reservedParcels.length > 0 ? `‚Ç¶${revenueExpected.toLocaleString()} pending from ${reservedParcels.length} reserved parcels` : 'No reserved parcels'}</p>
                    <p><strong>Average Sale Value:</strong> ‚Ç¶${soldParcels.length > 0 ? averageParcelPrice.toLocaleString() : '12,000,000'}</p>
                    <p><strong>Remaining Market Value:</strong> ‚Ç¶${remainingRevenuePotential.toLocaleString()} from ${50 - soldParcels.length - reservedParcels.length} available parcels</p>
                </div>
                
                <div style="margin-top: 15px; text-align: center; color: #666; font-size: 12px;">
                    <p>üîÑ Data syncs automatically every 30 seconds ‚Ä¢ Use "Admin Sync" for immediate updates</p>
                </div>
            `;
        }
    </script>
    
    <!-- Contact Modal -->
    <div id="contactModal" class="contact-modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Interested in Parcel <span id="modalParcelId"></span>?</h3>
                <button class="close-btn" onclick="closeContactModal()">&times;</button>
            </div>
            <div class="modal-body">
                <form id="contactForm" onsubmit="submitContactForm(event)">
                    <div class="form-group">
                        <label>Full Name *</label>
                        <input type="text" id="contactName" placeholder="Enter your full name" required>
                    </div>
                    <div class="form-group">
                        <label>Phone Number *</label>
                        <input type="tel" id="contactPhone" placeholder="Enter your phone number" required>
                    </div>
                    <div class="form-group">
                        <label>Email Address *</label>
                        <input type="email" id="contactEmail" placeholder="Enter your email" required>
                    </div>
                    <div class="form-group">
                        <label>Message (Optional)</label>
                        <textarea id="contactMessage" placeholder="Tell us about your interest..." rows="3"></textarea>
                    </div>
                    <div class="form-actions">
                        <button type="submit" class="btn-submit">üìã Request Information</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    
    <!-- Database Panel -->
    <div id="databasePanel" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
         background: rgba(0,0,0,0.8); z-index: 10000; overflow-y: auto; padding: 20px; box-sizing: border-box;">
        <div style="background: white; border-radius: 10px; max-width: 1200px; margin: 0 auto; padding: 0; box-shadow: 0 4px 20px rgba(0,0,0,0.3);">
            <div style="background: linear-gradient(135deg, #6f42c1 0%, #5a2d91 100%); color: white; padding: 20px; border-radius: 10px 10px 0 0; display: flex; justify-content: space-between; align-items: center;">
                <h2 style="margin: 0; font-size: 24px;">üóÉÔ∏è Estate Database</h2>
                <button onclick="closeDatabasePanel()" style="background: rgba(255,255,255,0.2); color: white; border: none; padding: 8px 12px; border-radius: 5px; cursor: pointer; font-size: 18px;">‚úï</button>
            </div>
            <div id="databaseBody" style="padding: 20px; max-height: 70vh; overflow-y: auto;">
                Loading database...
            </div>
        </div>
    </div>
    
    <!-- Sync Status Display -->
    <div id="syncStatus" style="display: none; position: fixed; top: 20px; left: 20px; right: 20px; z-index: 9999; margin: 0 auto; max-width: 600px;"></div>
    
    <div class="az-footer">
        <span>A&Z Projects Ltd | UK: <a href="tel:+447887969508">+44 788 796 9508</a> | NG: <a href="tel:+2348068086806">+234 806 808 6806</a> | <a href="mailto:info@azprojectsltd.com">info@azprojectsltd.com</a></span>
    </div>
</body>
</html>


